<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
  "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>code coverage of views.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">

<style type="text/css">
pre.code {
    font-style: Lucida,"Courier New";
}
.number {
    color: #0080C0;
}
.operator {
    color: #000000;
}
.string {
    color: #008000;
}
.comment {
    color: #808080;
}
.name {
    color: #000000;
}
.error {
    color: #FF8080;
    border: solid 1.5pt #FF0000;
}
.keyword {
    color: #0000FF;
    font-weight: bold;
}
.text {
    color: #000000;
}
.notcovered {
    background-color: #FFB2B2;
}
</style>

</head>
<body>
<pre class="code">
<span class="string">''' 
        This file describes the various views of user statistics

        @author Andrew J. Musselman
'''</span><span class="text">
</span><span class="text">
</span><span class="keyword">from</span> <span class="name">django</span><span class="operator">.</span><span class="name">shortcuts</span> <span class="keyword">import</span> <span class="name">render_to_response</span><span class="text">
</span><span class="keyword">from</span> <span class="name">django</span><span class="operator">.</span><span class="name">http</span> <span class="keyword">import</span> <span class="name">HttpResponseRedirect</span><span class="text">
</span><span class="keyword">from</span> <span class="name">courses</span><span class="operator">.</span><span class="name">models</span> <span class="keyword">import</span> <span class="name">Course</span><span class="text">
</span><span class="keyword">from</span> <span class="name">stats</span><span class="operator">.</span><span class="name">models</span> <span class="keyword">import</span> <span class="name">Stat</span><span class="text">
</span><span class="keyword">from</span> <span class="name">stats</span><span class="operator">.</span><span class="name">stat</span> <span class="keyword">import</span> <span class="operator">*</span><span class="text">
</span><span class="keyword">from</span> <span class="name">django</span><span class="operator">.</span><span class="name">contrib</span><span class="operator">.</span><span class="name">auth</span><span class="operator">.</span><span class="name">models</span> <span class="keyword">import</span> <span class="name">User</span><span class="text">
</span><span class="keyword">from</span> <span class="name">django</span><span class="operator">.</span><span class="name">db</span> <span class="keyword">import</span> <span class="name">IntegrityError</span><span class="text">
</span><span class="keyword">from</span> <span class="name">django</span><span class="operator">.</span><span class="name">template</span><span class="operator">.</span><span class="name">defaultfilters</span> <span class="keyword">import</span> <span class="name">slugify</span> <span class="text">
</span><span class="keyword">from</span> <span class="name">django</span><span class="operator">.</span><span class="name">contrib</span><span class="operator">.</span><span class="name">auth</span><span class="operator">.</span><span class="name">decorators</span> <span class="keyword">import</span> <span class="name">login_required</span><span class="text">
</span><span class="keyword">from</span> <span class="name">home</span><span class="operator">.</span><span class="name">views</span> <span class="keyword">import</span> <span class="name">master_rtr</span><span class="text">
</span><span class="text">
</span><span class="comment"># Create your views here.
</span><span class="operator">@</span><span class="name">login_required</span><span class="text">
</span><span class="keyword">def</span> <span class="name">display_course_stats</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="name">course_slug</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>        <span class="string">'''Displays stats for a given course'''</span><span class="text">
</span>        <span class="comment">#Make sure the course is a real course in the DBMS
</span><span class="notcovered">        <span class="keyword">try</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                <span class="name">course</span> <span class="operator">=</span> <span class="name">Course</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">slug</span><span class="operator">=</span><span class="name">course_slug</span><span class="operator">)</span></span>   <span class="text">
</span><span class="notcovered">        <span class="keyword">except</span> <span class="name">Course</span><span class="operator">.</span><span class="name">DoesNotExist</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                <span class="keyword">raise</span> <span class="name">Http404</span></span><span class="text">
</span><span class="notcovered"></span>                                                <span class="text">
</span><span class="notcovered">        <span class="comment">#make sure the user has premissions to view stats.
</span>        <span class="name">enrollment</span> <span class="operator">=</span> <span class="name">request</span><span class="operator">.</span><span class="name">user</span><span class="operator">.</span><span class="name">enrollments</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">course</span><span class="operator">=</span><span class="name">course</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">        <span class="keyword">if</span> <span class="name">enrollment</span><span class="operator">.</span><span class="name">stats</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                <span class="name">bestQuizAggregates</span> <span class="operator">=</span> <span class="name">getQuizBestAggregates</span><span class="operator">(</span><span class="name">course</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                <span class="name">bestUserAggregates</span> <span class="operator">=</span> <span class="name">getUserBestAggregates</span><span class="operator">(</span><span class="name">course</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                <span class="name">stat_data</span> <span class="operator">=</span> <span class="operator">{</span><span class="string">'course'</span><span class="operator">:</span><span class="name">course</span><span class="operator">,</span>\
                             <span class="string">'bestQuizAggregates'</span><span class="operator">:</span><span class="name">bestQuizAggregates</span><span class="operator">,</span>\
                                         <span class="string">'bestUserAggregates'</span><span class="operator">:</span><span class="name">bestUserAggregates</span><span class="operator">,</span> \
                                         <span class="string">'course_slug'</span><span class="operator">:</span><span class="name">course_slug</span><span class="operator">}</span></span> <span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered">                <span class="keyword">return</span> <span class="name">master_rtr</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="string">'stats/show_course_stats.html'</span><span class="operator">,</span> <span class="name">stat_data</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">        <span class="keyword">else</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                <span class="comment">#Or else, you don't have premeission to view stats
</span>                <span class="keyword">return</span> <span class="name">master_rtr</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="string">'stats/invalid_user_premissions.html'</span><span class="operator">,</span> \
                                <span class="operator">{</span><span class="string">'course'</span><span class="operator">:</span> <span class="name">course</span><span class="operator">,</span> \
                                 <span class="string">'course_slug'</span><span class="operator">:</span> <span class="name">course_slug</span><span class="operator">}</span><span class="operator">)</span><span class="text"></span></span>
</pre></body>
</html>
