<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
  "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>code coverage of course.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">

<style type="text/css">
pre.code {
    font-style: Lucida,"Courier New";
}
.number {
    color: #0080C0;
}
.operator {
    color: #000000;
}
.string {
    color: #008000;
}
.comment {
    color: #808080;
}
.name {
    color: #000000;
}
.error {
    color: #FF8080;
    border: solid 1.5pt #FF0000;
}
.keyword {
    color: #0000FF;
    font-weight: bold;
}
.text {
    color: #000000;
}
.notcovered {
    background-color: #FFB2B2;
}
</style>

</head>
<body>
<pre class="code">
<span class="string">'''
Contains operations for Courses

@author: Matthew Tytel
@author: Mark Gius

'''</span><span class="text">
</span><span class="notcovered"><span class="keyword">from</span> <span class="name">courses</span><span class="operator">.</span><span class="name">models</span> <span class="keyword">import</span> <span class="operator">*</span></span><span class="text">
</span><span class="notcovered"><span class="keyword">from</span> <span class="name">courses</span><span class="operator">.</span><span class="name">enrollment</span> <span class="keyword">import</span> <span class="operator">*</span></span><span class="text">
</span><span class="notcovered"><span class="keyword">from</span> <span class="name">pages</span><span class="operator">.</span><span class="name">lesson</span><span class="operator">.</span><span class="name">models</span> <span class="keyword">import</span> <span class="name">Lesson</span></span><span class="text">
</span><span class="notcovered"><span class="keyword">from</span> <span class="name">pages</span><span class="operator">.</span><span class="name">lesson</span><span class="operator">.</span><span class="name">lesson</span> <span class="keyword">import</span> <span class="name">saveLessonName</span></span><span class="text">
</span><span class="notcovered"><span class="keyword">from</span> <span class="name">pages</span><span class="operator">.</span><span class="name">models</span> <span class="keyword">import</span> <span class="name">Page</span></span><span class="text">
</span><span class="notcovered"><span class="keyword">import</span> <span class="name">StringIO</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered"><span class="keyword">def</span> <span class="name">CreateCourse</span><span class="operator">(</span><span class="name">name</span><span class="operator">,</span> <span class="name">user</span><span class="operator">,</span> <span class="name">private</span><span class="operator">,</span> <span class="name">slug</span><span class="operator">=</span><span class="name">None</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">        <span class="string">''' Creates a new course

                 Takes in the name of the course and a user object, and an optional
                 slug string. Creates a new course, enrolls the user in the course and 
                 assigns all permissions to them.  Returns the course after saving it
                 it.  Have to save it so that enrollment gets an id to link to
        '''</span></span><span class="text">
</span><span class="notcovered">        <span class="comment"># check for empty string (or default value)
</span>        <span class="keyword">if</span> <span class="keyword">not</span> <span class="name">slug</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                <span class="name">slug</span> <span class="operator">=</span> <span class="name">slugify</span><span class="operator">(</span><span class="name">name</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered">        <span class="name">newcourse</span> <span class="operator">=</span> <span class="name">Course</span><span class="operator">(</span><span class="name">name</span><span class="operator">=</span><span class="name">name</span><span class="operator">,</span> <span class="name">slug</span><span class="operator">=</span><span class="name">slug</span><span class="operator">,</span> <span class="name">private</span><span class="operator">=</span><span class="name">private</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">        <span class="name">newcourse</span><span class="operator">.</span><span class="name">save</span><span class="operator">(</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered">        <span class="name">addUser</span><span class="operator">(</span><span class="name">newcourse</span><span class="operator">,</span> <span class="name">user</span><span class="operator">,</span> <span class="name">True</span><span class="operator">,</span> <span class="name">True</span><span class="operator">,</span> <span class="name">True</span><span class="operator">,</span> <span class="name">True</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered">        <span class="comment"># Create the new landing page
</span></span><span class="text">
</span><span class="notcovered">        <span class="name">newpage</span> <span class="operator">=</span> <span class="name">Lesson</span><span class="operator">(</span><span class="name">course</span><span class="operator">=</span><span class="name">newcourse</span><span class="operator">,</span> <span class="name">slug</span><span class="operator">=</span><span class="name">slug</span><span class="operator">,</span> <span class="name">name</span><span class="operator">=</span><span class="name">name</span><span class="operator">,</span> <span class="name">left</span><span class="operator">=</span><span class="number">1</span><span class="operator">,</span> <span class="name">right</span><span class="operator">=</span><span class="number">2</span><span class="operator">,</span>\
                                   <span class="name">content</span><span class="operator">=</span><span class="string">"Landing page for "</span> <span class="operator">+</span> <span class="name">slug</span> <span class="operator">+</span>\
                                                          <span class="string">"&lt;br /&gt;Your content here"</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">        <span class="name">newpage</span><span class="operator">.</span><span class="name">save</span><span class="operator">(</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered">        <span class="keyword">return</span> <span class="name">newcourse</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered"><span class="keyword">def</span> <span class="name">renameCourse</span><span class="operator">(</span><span class="name">course</span><span class="operator">,</span> <span class="name">newName</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">        <span class="string">''' 
        Renames a course

        @author Matt Tytel
        '''</span></span><span class="text">
</span><span class="notcovered">        <span class="keyword">if</span> <span class="name">len</span><span class="operator">(</span><span class="name">newName</span><span class="operator">.</span><span class="name">strip</span><span class="operator">(</span><span class="operator">)</span><span class="operator">)</span> <span class="operator">&lt;</span> <span class="number">1</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                <span class="keyword">return</span> <span class="operator">{</span><span class="string">'message'</span><span class="operator">:</span><span class="string">"Name change failed: name must be non-empty"</span><span class="operator">}</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered">        <span class="comment">#check that the newLessonName doesn't already exist in this course
</span>        <span class="name">newSlug</span> <span class="operator">=</span> <span class="name">slugify</span><span class="operator">(</span><span class="name">newName</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered">        <span class="comment">#search the pages in the course to see if the slug is unique
</span>        <span class="name">courseExists</span> <span class="operator">=</span> <span class="name">Course</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">filter</span><span class="operator">(</span><span class="name">slug</span><span class="operator">=</span><span class="name">newSlug</span><span class="operator">)</span><span class="operator">.</span><span class="name">count</span><span class="operator">(</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">        <span class="keyword">if</span> <span class="name">courseExists</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                <span class="keyword">return</span> <span class="operator">{</span><span class="string">'message'</span><span class="operator">:</span><span class="string">"Name change failed. A course with that name already exists"</span><span class="operator">}</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered">        <span class="name">pageExists</span> <span class="operator">=</span> <span class="name">Page</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">filter</span><span class="operator">(</span><span class="name">course</span><span class="operator">=</span><span class="name">course</span><span class="operator">)</span><span class="operator">.</span><span class="name">filter</span><span class="operator">(</span><span class="name">slug</span><span class="operator">=</span><span class="name">newSlug</span><span class="operator">)</span><span class="operator">.</span><span class="name">count</span><span class="operator">(</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">        <span class="keyword">if</span> <span class="name">pageExists</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                <span class="keyword">return</span> <span class="operator">{</span><span class="string">'message'</span><span class="operator">:</span><span class="string">"Name change failed. A page with that name already exists in this course"</span><span class="operator">}</span></span><span class="text">
</span><span class="notcovered"></span>        <span class="text">
</span><span class="notcovered">        <span class="name">course</span><span class="operator">.</span><span class="name">name</span> <span class="operator">=</span> <span class="name">newName</span></span><span class="text">
</span><span class="notcovered">        <span class="name">course</span><span class="operator">.</span><span class="name">slug</span> <span class="operator">=</span> <span class="name">newSlug</span></span><span class="text">
</span><span class="notcovered">        <span class="name">course</span><span class="operator">.</span><span class="name">save</span><span class="operator">(</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">        <span class="comment">#also change the 'index' lesson to reflect name change
</span>        <span class="name">indexPage</span> <span class="operator">=</span> <span class="name">Lesson</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">course</span> <span class="operator">=</span> <span class="name">course</span><span class="operator">,</span> <span class="name">left</span> <span class="operator">=</span> <span class="number">1</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">        <span class="name">ret</span> <span class="operator">=</span> <span class="name">saveLessonName</span><span class="operator">(</span><span class="name">indexPage</span><span class="operator">,</span> <span class="name">newName</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">        <span class="keyword">if</span> <span class="string">'message'</span> <span class="keyword">in</span> <span class="name">ret</span><span class="operator">:</span><span class="comment">#indicates failure SHOULD NOT HAPPEN EVER</span></span><span class="text">
</span><span class="notcovered">                <span class="keyword">return</span> <span class="name">ret</span></span><span class="text">
</span><span class="notcovered">        <span class="keyword">if</span> <span class="string">'lesson'</span> <span class="keyword">in</span> <span class="name">ret</span><span class="operator">:</span><span class="comment">#indicates success, should always happen</span></span><span class="text">
</span><span class="notcovered">                <span class="keyword">return</span> <span class="operator">{</span><span class="string">'course'</span><span class="operator">:</span><span class="name">course</span><span class="operator">,</span> <span class="string">'lesson'</span><span class="operator">:</span> <span class="name">ret</span><span class="operator">[</span><span class="string">'lesson'</span><span class="operator">]</span><span class="operator">}</span></span><span class="text">
</span><span class="notcovered">        <span class="comment">#left this in case a bozo changes saveLessonName
</span>        <span class="keyword">return</span> <span class="operator">{</span><span class="string">'course'</span><span class="operator">:</span><span class="name">course</span><span class="operator">}</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered"><span class="keyword">def</span> <span class="name">addUser</span><span class="operator">(</span><span class="name">self</span><span class="operator">,</span> <span class="name">user</span><span class="operator">,</span> <span class="name">view</span> <span class="operator">=</span> <span class="name">True</span><span class="operator">,</span> <span class="name">edit</span><span class="operator">=</span><span class="name">False</span><span class="operator">,</span> <span class="name">stats</span><span class="operator">=</span><span class="name">False</span><span class="operator">,</span> <span class="name">manage</span><span class="operator">=</span><span class="name">False</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span>        <span class="string">''' Adds a User to a course 
        
            Takes in a user, and optional boolean values for edit, stats, and
            manage permission, in that order. Creates a new enrollment for that
            user and permission level and adds it to the Course.  

                 Returns the  enrollment after saving it to the database, 
                 or None if the user was already enrolled

                 @author Mark Gius
        '''</span><span class="text">
</span>   <span class="comment"># test for user/course enrollment already
</span>        <span class="keyword">try</span><span class="operator">:</span><span class="text">
</span>                <span class="name">Enrollment</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">user</span><span class="operator">=</span><span class="name">user</span><span class="operator">,</span> <span class="name">course</span><span class="operator">=</span><span class="name">self</span><span class="operator">)</span><span class="text">
</span>        <span class="keyword">except</span> <span class="name">Enrollment</span><span class="operator">.</span><span class="name">DoesNotExist</span><span class="operator">:</span><span class="text">
</span>                <span class="name">enrollment</span> <span class="operator">=</span> <span class="name">CreateEnrollment</span><span class="operator">(</span><span class="name">user</span><span class="operator">,</span> <span class="name">self</span><span class="operator">,</span> \
                                              <span class="name">view</span><span class="operator">,</span> <span class="name">edit</span><span class="operator">,</span> <span class="name">stats</span><span class="operator">,</span> <span class="name">manage</span><span class="operator">)</span><span class="text">
</span>                <span class="name">enrollment</span><span class="operator">.</span><span class="name">save</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>                <span class="keyword">return</span> <span class="name">enrollment</span><span class="text">
</span>        <span class="comment"># Enrollment already exists
</span><span class="notcovered">        <span class="keyword">return</span> <span class="name">None</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered"><span class="keyword">def</span> <span class="name">removeUser</span><span class="operator">(</span><span class="name">self</span><span class="operator">,</span> <span class="name">user</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span>        <span class="string">'''
                Removes the specified user from the course

                @author Mark Gius
                @author Jon Inloes
        '''</span><span class="text">
</span>        <span class="comment">#print 'removing a user'
</span>        <span class="keyword">try</span><span class="operator">:</span><span class="text">
</span>                <span class="name">Enrollment</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">user</span><span class="operator">=</span><span class="name">user</span><span class="operator">,</span> <span class="name">course</span><span class="operator">=</span><span class="name">self</span><span class="operator">)</span><span class="operator">.</span><span class="name">delete</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>        <span class="keyword">except</span><span class="operator">:</span><span class="text">
</span><span class="notcovered">                <span class="keyword">print</span> <span class="string">'remove failed'</span></span>   <span class="text">
</span>        <span class="keyword">return</span> <span class="name">None</span><span class="text">
</span><span class="text">
</span><span class="notcovered"><span class="keyword">def</span> <span class="name">removeCourse</span><span class="operator">(</span><span class="name">course_slug</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">        <span class="string">'''
        Removes this course and all of its pages, statistics, and enrollments
        from the database
        @pre course_slug is a string
        @post if course_slug points to a valid course, it will be removed from the database along with all related objects.

        @author Russell Mezzetta
        '''</span></span><span class="text">
</span><span class="notcovered">        <span class="keyword">try</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                <span class="name">c</span> <span class="operator">=</span> <span class="name">Course</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">slug</span><span class="operator">=</span><span class="name">course_slug</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                <span class="name">c</span><span class="operator">.</span><span class="name">delete</span><span class="operator">(</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                <span class="keyword">return</span> <span class="name">c</span></span><span class="text">
</span><span class="notcovered">        <span class="keyword">except</span> <span class="name">Course</span><span class="operator">.</span><span class="name">DoesNotExist</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                <span class="keyword">return</span> <span class="name">None</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered"><span class="keyword">def</span> <span class="name">setPrivate</span><span class="operator">(</span><span class="name">self</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">        <span class="string">'''
        Sets the private bit for a course

        @author Mark Gius
        '''</span></span><span class="text">
</span><span class="notcovered">        <span class="name">self</span><span class="operator">.</span><span class="name">private</span> <span class="operator">=</span> <span class="name">True</span></span><span class="text">
</span><span class="notcovered">        <span class="name">self</span><span class="operator">.</span><span class="name">save</span><span class="operator">(</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered"><span class="keyword">def</span> <span class="name">addUsersFromFile</span><span class="operator">(</span><span class="name">course</span><span class="operator">,</span> <span class="name">files</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span>        <span class="string">'''
        Adds users from a text file to a course

        pre: none
        post: for each username in files
                                enrollment.username.view = true

        @author Jon Inloes
        '''</span><span class="text">
</span><span class="text">
</span>        <span class="name">failedList</span> <span class="operator">=</span> <span class="operator">[</span><span class="operator">]</span><span class="text">
</span>        <span class="keyword">for</span> <span class="name">k</span><span class="operator">,</span><span class="name">v</span><span class="operator">,</span> <span class="keyword">in</span> <span class="name">files</span><span class="operator">.</span><span class="name">iteritems</span><span class="operator">(</span><span class="operator">)</span><span class="operator">:</span><span class="comment">#request.FILES.iteritems():</span><span class="text">
</span>                <span class="comment">#print k, v
</span>                <span class="name">infile</span> <span class="operator">=</span> <span class="name">files</span><span class="operator">[</span><span class="name">k</span><span class="operator">]</span><span class="comment">#request.FILES[k]</span><span class="text">
</span><span class="text">
</span>                <span class="name">output</span> <span class="operator">=</span> <span class="name">StringIO</span><span class="operator">.</span><span class="name">StringIO</span><span class="operator">(</span><span class="name">infile</span><span class="operator">.</span><span class="name">read</span><span class="operator">(</span><span class="operator">)</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span>                <span class="keyword">for</span> <span class="name">line</span> <span class="keyword">in</span> <span class="name">output</span><span class="operator">:</span><span class="text">
</span>                        <span class="name">name</span> <span class="operator">=</span> <span class="name">line</span><span class="operator">.</span><span class="name">strip</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>                        <span class="comment">#print line.strip()
</span>                        <span class="keyword">try</span><span class="operator">:</span><span class="text">
</span>                                <span class="comment">#if the user exists add it
</span>                                <span class="name">user</span> <span class="operator">=</span> <span class="name">User</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">username</span><span class="operator">=</span><span class="name">name</span><span class="operator">)</span><span class="text">
</span>                                <span class="name">addUser</span><span class="operator">(</span><span class="name">course</span><span class="operator">,</span> <span class="name">user</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span>                        <span class="keyword">except</span> <span class="name">User</span><span class="operator">.</span><span class="name">DoesNotExist</span><span class="operator">:</span><span class="text">
</span>                                <span class="comment">#if the user does not exist add it to the failed list
</span>                                <span class="name">failedList</span><span class="operator">.</span><span class="name">append</span><span class="operator">(</span><span class="name">name</span><span class="operator">)</span><span class="operator">;</span><span class="text">
</span>                                <span class="comment">#return master_rtr(request, 'adduser/failed.html', \
</span>                                <span class="comment">#                              {'course_slug':course_slug, \
</span>                                <span class="comment">#                               'course': course})
</span>                                        <span class="text">
</span>        <span class="comment">#print failedList
</span><span class="text">
</span>        <span class="keyword">return</span> <span class="name">failedList</span><span class="text">
</span><span class="comment"># Everything below here is probably supposed to be in views.py -mgius
</span><span class="comment"># commented out by mgius on 2/16/10
</span><span class="comment">#def removeCourse(request):
</span><span class="comment">#       '''
</span><span class="comment">#       Removes a specified course from existence
</span><span class="comment">#
</span><span class="comment">#       This operation returns an http response for viewing the deletion of the course
</span><span class="comment">#       '''
</span><span class="comment">#       pass
</span><span class="comment">#
</span><span class="comment">#
</span><span class="comment">#def setPrivate(request):
</span><span class="comment">#       '''
</span><span class="comment">#       Set's the class to public/private depending on what is specified
</span><span class="comment">#
</span><span class="comment">#       This operation returns an http response for viewing the privacy change
</span><span class="comment">#       '''
</span><span class="comment">#       pass
</span><span class="comment">#
</span><span class="comment">#def search(request):
</span><span class="comment">#       '''
</span><span class="comment">#       Searches a specified class for a page
</span><span class="comment">#
</span><span class="comment">#       This operation returns an http response for viewing the search results
</span><span class="comment">#       '''
</span><span class="comment">#       pass
</span><span class="comment">#
</span><span class="comment">#def importCourse(request):
</span><span class="comment">#       '''
</span><span class="comment">#       Imports specified information into a Course
</span><span class="comment">#
</span><span class="comment">#       This operation returns an http response for viewing the import
</span><span class="comment">#       '''
</span><span class="comment">#       pass
</span><span class="comment">#
</span><span class="comment">#def exportCourse(request):
</span><span class="comment">#       '''
</span><span class="comment">#       Exports the specified Course
</span><span class="comment">#
</span><span class="comment">#       This operation returns an http response with the export data
</span><span class="comment">#       '''
</span><span class="comment">#       pass</span><span class="text"></span>
</pre></body>
</html>
