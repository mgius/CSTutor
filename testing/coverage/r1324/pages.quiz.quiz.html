<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
  "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>code coverage of quiz.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">

<style type="text/css">
pre.code {
    font-style: Lucida,"Courier New";
}
.number {
    color: #0080C0;
}
.operator {
    color: #000000;
}
.string {
    color: #008000;
}
.comment {
    color: #808080;
}
.name {
    color: #000000;
}
.error {
    color: #FF8080;
    border: solid 1.5pt #FF0000;
}
.keyword {
    color: #0000FF;
    font-weight: bold;
}
.text {
    color: #000000;
}
.notcovered {
    background-color: #FFB2B2;
}
</style>

</head>
<body>
<pre class="code">
<span class="string">'''
quiz.py fil for quiz related operations.

Contains operations for all lessons

@author Evan Kleist
'''</span><span class="text">
</span><span class="notcovered"><span class="keyword">from</span> <span class="name">django</span><span class="operator">.</span><span class="name">template</span><span class="operator">.</span><span class="name">defaultfilters</span> <span class="keyword">import</span> <span class="name">slugify</span></span><span class="text">
</span><span class="notcovered"><span class="keyword">from</span> <span class="name">models</span> <span class="keyword">import</span> <span class="operator">*</span></span><span class="text">
</span><span class="notcovered"><span class="keyword">from</span> <span class="name">question</span><span class="operator">.</span><span class="name">models</span> <span class="keyword">import</span> <span class="operator">*</span></span><span class="text">
</span><span class="notcovered"><span class="keyword">from</span> <span class="name">question</span><span class="operator">.</span><span class="name">question</span> <span class="keyword">import</span> <span class="operator">*</span></span><span class="text">
</span><span class="notcovered"><span class="keyword">from</span> <span class="name">pages</span><span class="operator">.</span><span class="name">page</span> <span class="keyword">import</span> <span class="name">removePage</span></span><span class="text">
</span><span class="notcovered"><span class="keyword">from</span> <span class="name">stats</span><span class="operator">.</span><span class="name">models</span> <span class="keyword">import</span> <span class="name">Stat</span></span><span class="text">
</span><span class="notcovered"><span class="keyword">from</span> <span class="name">codeshell</span><span class="operator">.</span><span class="name">pythoncode</span> <span class="keyword">import</span> <span class="operator">*</span></span><span class="text">
</span><span class="notcovered"><span class="keyword">from</span> <span class="name">stats</span><span class="operator">.</span><span class="name">models</span> <span class="keyword">import</span> <span class="name">Stat</span></span><span class="text">
</span><span class="notcovered"><span class="keyword">from</span> <span class="name">stats</span><span class="operator">.</span><span class="name">stat</span> <span class="keyword">import</span> <span class="name">getUserBestScore</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered"><span class="keyword">def</span> <span class="name">addCodeQuestion</span><span class="operator">(</span><span class="name">self</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span>        <span class="string">'''
        Takes a quiz and adds a blank code question to it

        @author Evan Kleist
        '''</span><span class="text">
</span>        <span class="name">questions</span> <span class="operator">=</span> <span class="name">self</span><span class="operator">.</span><span class="name">questions</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>        <span class="name">newQuestion</span> <span class="operator">=</span> <span class="name">CodeQuestion</span><span class="operator">(</span><span class="name">order</span><span class="operator">=</span><span class="operator">(</span><span class="name">len</span><span class="operator">(</span><span class="name">questions</span><span class="operator">)</span><span class="operator">+</span><span class="number">1</span><span class="operator">)</span><span class="operator">,</span> <span class="name">quiz</span><span class="operator">=</span><span class="name">self</span><span class="operator">)</span><span class="text">
</span>        <span class="name">newQuestion</span><span class="operator">.</span><span class="name">save</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>        <span class="keyword">return</span> <span class="name">newQuestion</span><span class="text">
</span><span class="text">
</span><span class="notcovered"><span class="keyword">def</span> <span class="name">addMultipleChoiceQuestion</span><span class="operator">(</span><span class="name">self</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span>        <span class="string">'''
        Takes a quiz and adds a blank multiple choice question to it, as well as 2 blank answers

        @author Evan Kleist
        '''</span><span class="text">
</span>        <span class="name">questions</span> <span class="operator">=</span> <span class="name">self</span><span class="operator">.</span><span class="name">questions</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>        <span class="name">newQuestion</span> <span class="operator">=</span> <span class="name">MultipleChoiceQuestion</span><span class="operator">(</span><span class="name">order</span><span class="operator">=</span><span class="operator">(</span><span class="name">len</span><span class="operator">(</span><span class="name">questions</span><span class="operator">)</span><span class="operator">+</span><span class="number">1</span><span class="operator">)</span><span class="operator">,</span> <span class="name">quiz</span><span class="operator">=</span><span class="name">self</span><span class="operator">)</span><span class="text">
</span>        <span class="name">newQuestion</span><span class="operator">.</span><span class="name">save</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>        <span class="name">addAnswer</span><span class="operator">(</span><span class="name">newQuestion</span><span class="operator">)</span><span class="text">
</span>        <span class="name">addAnswer</span><span class="operator">(</span><span class="name">newQuestion</span><span class="operator">)</span><span class="text">
</span>        <span class="keyword">return</span> <span class="name">newQuestion</span><span class="text">
</span><span class="text">
</span><span class="notcovered"><span class="keyword">def</span> <span class="name">addPath</span><span class="operator">(</span><span class="name">self</span><span class="operator">,</span> <span class="name">request</span><span class="operator">,</span> <span class="name">course_slug</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span>        <span class="string">'''
                Takes a working copy of a quiz, a request containing post data, and a course_slug
                and adds a path to the quiz

                pre: must be a POST and contain the post data

                @author Evan Kleist
        '''</span><span class="text">
</span>        <span class="name">errors</span> <span class="operator">=</span> <span class="operator">[</span><span class="operator">]</span><span class="text">
</span>        <span class="keyword">try</span><span class="operator">:</span><span class="text">
</span>                <span class="name">lowScore</span> <span class="operator">=</span> <span class="name">int</span><span class="operator">(</span><span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">[</span><span class="string">"LowScore"</span><span class="operator">]</span><span class="operator">)</span><span class="text">
</span>                <span class="keyword">if</span> <span class="operator">(</span><span class="name">lowScore</span> <span class="operator">&lt;</span> <span class="number">0</span> <span class="keyword">or</span> <span class="name">lowScore</span> <span class="operator">&gt;</span> <span class="number">100</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                        <span class="name">errors</span><span class="operator">.</span><span class="name">append</span><span class="operator">(</span><span class="string">"Low Score must be between 0 and 100"</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span>                <span class="keyword">try</span><span class="operator">:</span><span class="text">
</span>                        <span class="name">matchingPath</span> <span class="operator">=</span> <span class="name">matchPath</span><span class="operator">(</span><span class="name">self</span><span class="operator">,</span> <span class="name">lowScore</span><span class="operator">)</span><span class="text">
</span>                        <span class="name">errors</span><span class="operator">.</span><span class="name">append</span><span class="operator">(</span><span class="string">"A path that matches this range exists already"</span><span class="operator">)</span><span class="text">
</span>                <span class="keyword">except</span> <span class="name">NoMatchingPath</span><span class="operator">:</span><span class="text">
</span>                        <span class="keyword">pass</span>                    <span class="text">
</span>        <span class="keyword">except</span> <span class="name">ValueError</span><span class="operator">:</span><span class="text">
</span>                <span class="name">lowScore</span> <span class="operator">=</span> <span class="number">0</span><span class="text">
</span>                <span class="name">errors</span><span class="operator">.</span><span class="name">append</span><span class="operator">(</span><span class="string">"Low Score must be an integer"</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span>        <span class="keyword">try</span><span class="operator">:</span><span class="text">
</span>                <span class="name">highScore</span> <span class="operator">=</span> <span class="name">int</span><span class="operator">(</span><span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">[</span><span class="string">"HighScore"</span><span class="operator">]</span><span class="operator">)</span><span class="text">
</span>                <span class="keyword">if</span> <span class="operator">(</span><span class="name">highScore</span> <span class="operator">&lt;</span> <span class="number">0</span> <span class="keyword">or</span> <span class="name">highScore</span> <span class="operator">&gt;</span> <span class="number">100</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                        <span class="name">errors</span><span class="operator">.</span><span class="name">append</span><span class="operator">(</span><span class="string">"High Score must be between 0 and 100"</span><span class="operator">)</span><span class="text">
</span>                <span class="keyword">if</span> <span class="operator">(</span><span class="name">highScore</span> <span class="operator">&lt;</span> <span class="name">lowScore</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                        <span class="name">errors</span><span class="operator">.</span><span class="name">append</span><span class="operator">(</span><span class="string">"Low Score must be less than or equal to High Score"</span><span class="operator">)</span><span class="text">
</span>        <span class="keyword">except</span> <span class="name">ValueError</span><span class="operator">:</span><span class="text">
</span>                <span class="name">errors</span><span class="operator">.</span><span class="name">append</span><span class="operator">(</span><span class="string">"High Score must be an integer"</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span>        <span class="name">course</span> <span class="operator">=</span> <span class="name">Course</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">slug</span><span class="operator">=</span><span class="name">course_slug</span><span class="operator">)</span><span class="text">
</span>        <span class="name">page</span> <span class="operator">=</span> <span class="name">course</span><span class="operator">.</span><span class="name">pages</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">slug</span><span class="operator">=</span><span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">[</span><span class="string">"pathPage"</span><span class="operator">]</span><span class="operator">)</span><span class="text">
</span>        <span class="name">passing</span> <span class="operator">=</span> <span class="string">"passing"</span> <span class="keyword">in</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="text">
</span>        <span class="name">dialogue</span> <span class="operator">=</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">[</span><span class="string">"dialogue"</span><span class="operator">]</span><span class="text">
</span><span class="text">
</span>        <span class="keyword">if</span> <span class="operator">(</span><span class="name">len</span><span class="operator">(</span><span class="name">errors</span><span class="operator">)</span> <span class="operator">==</span> <span class="number">0</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                <span class="name">newPath</span> <span class="operator">=</span> <span class="name">Path</span><span class="operator">(</span><span class="name">quiz</span> <span class="operator">=</span> <span class="name">self</span><span class="operator">,</span> <span class="name">highscore</span> <span class="operator">=</span> <span class="name">highScore</span><span class="operator">,</span> <span class="name">lowscore</span> <span class="operator">=</span> <span class="name">lowScore</span><span class="operator">,</span> <span class="name">toPage</span> <span class="operator">=</span> <span class="name">page</span><span class="operator">,</span> <span class="name">passed</span> <span class="operator">=</span> <span class="name">passing</span><span class="operator">,</span> <span class="name">text</span> <span class="operator">=</span> <span class="name">dialogue</span><span class="operator">)</span><span class="text">
</span>                <span class="name">newPath</span><span class="operator">.</span><span class="name">save</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>                <span class="name">publishedCopy</span> <span class="operator">=</span> <span class="name">Quiz</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">slug</span> <span class="operator">=</span> <span class="name">safeSlug</span><span class="operator">(</span><span class="name">self</span><span class="operator">.</span><span class="name">slug</span><span class="operator">)</span><span class="operator">,</span> <span class="name">course</span><span class="operator">=</span><span class="name">course</span><span class="operator">)</span><span class="text">
</span>                <span class="name">publishedCopy</span><span class="operator">.</span><span class="name">upToDate</span> <span class="operator">=</span> <span class="name">False</span><span class="text">
</span>                <span class="name">publishedCopy</span><span class="operator">.</span><span class="name">save</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span>        <span class="keyword">return</span> <span class="name">errors</span><span class="text">
</span><span class="text">
</span><span class="notcovered"><span class="keyword">def</span> <span class="name">checkPrerequisites</span><span class="operator">(</span><span class="name">self</span><span class="operator">,</span> <span class="name">user</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span>        <span class="string">'''
                This function takes a quiz and a user. It then loooks the user's
                statistics up and makes sure all of the quizzes prerequisites
                have been met. If the user has edit permissions on the course,
                then it returns true. Otherwise, it returns true if all prereqs
                have been met and false if not.
        
                @author Evan Kleist
        '''</span><span class="text">
</span>        <span class="name">prereqs</span> <span class="operator">=</span> <span class="name">self</span><span class="operator">.</span><span class="name">prerequisites</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>        <span class="keyword">if</span> <span class="operator">(</span><span class="name">len</span><span class="operator">(</span><span class="name">prereqs</span><span class="operator">)</span> <span class="operator">&gt;</span> <span class="number">0</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                <span class="keyword">if</span> <span class="operator">(</span><span class="name">user</span><span class="operator">.</span><span class="name">is_anonymous</span><span class="operator">(</span><span class="operator">)</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                        <span class="keyword">return</span> <span class="name">False</span><span class="text">
</span>                <span class="name">enrollment</span> <span class="operator">=</span> <span class="name">user</span><span class="operator">.</span><span class="name">enrollments</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">course</span><span class="operator">=</span><span class="name">self</span><span class="operator">.</span><span class="name">course</span><span class="operator">)</span><span class="text">
</span>                <span class="keyword">if</span> <span class="operator">(</span><span class="keyword">not</span> <span class="name">enrollment</span><span class="operator">.</span><span class="name">edit</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                        <span class="keyword">for</span> <span class="name">p</span> <span class="keyword">in</span> <span class="name">prereqs</span><span class="operator">:</span><span class="text">
</span>                                <span class="name">requiredQuiz</span> <span class="operator">=</span> <span class="name">p</span><span class="operator">.</span><span class="name">requiredQuiz</span><span class="text">
</span>                                <span class="name">score</span> <span class="operator">=</span> <span class="name">getUserBestScore</span><span class="operator">(</span><span class="name">user</span><span class="operator">,</span> <span class="name">requiredQuiz</span><span class="operator">)</span><span class="text">
</span>                                <span class="name">path</span> <span class="operator">=</span> <span class="name">matchPath</span><span class="operator">(</span><span class="name">requiredQuiz</span><span class="operator">,</span> <span class="name">score</span><span class="operator">)</span><span class="text">
</span>                                <span class="keyword">if</span> <span class="operator">(</span><span class="name">path</span><span class="operator">.</span><span class="name">passed</span> <span class="operator">==</span> <span class="name">False</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                                        <span class="keyword">return</span> <span class="name">False</span><span class="text">
</span><span class="text">
</span>        <span class="keyword">return</span> <span class="name">True</span><span class="text">
</span><span class="text">
</span><span class="notcovered"><span class="keyword">def</span> <span class="name">copyQuiz</span><span class="operator">(</span><span class="name">quiz1</span><span class="operator">,</span> <span class="name">quiz2</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span>        <span class="string">'''
                Takes two quizzes and copies the contents of quiz1 into quiz2

                @author Evan Kleist
        '''</span><span class="text">
</span><span class="text">
</span>        <span class="comment"># Copy Title
</span>        <span class="name">quiz2</span><span class="operator">.</span><span class="name">text</span> <span class="operator">=</span> <span class="name">quiz1</span><span class="operator">.</span><span class="name">text</span><span class="text">
</span>        <span class="name">quiz2</span><span class="operator">.</span><span class="name">name</span> <span class="operator">=</span> <span class="name">quiz1</span><span class="operator">.</span><span class="name">name</span><span class="text">
</span><span class="text">
</span>        <span class="comment"># Copy Hidden
</span>        <span class="name">quiz2</span><span class="operator">.</span><span class="name">hidden</span> <span class="operator">=</span> <span class="name">quiz1</span><span class="operator">.</span><span class="name">hidden</span><span class="text">
</span><span class="text">
</span>        <span class="comment"># Copy Prerequisites
</span>        <span class="name">curPrereqs</span> <span class="operator">=</span> <span class="name">quiz2</span><span class="operator">.</span><span class="name">prerequisites</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>        <span class="keyword">for</span> <span class="name">p</span> <span class="keyword">in</span> <span class="name">curPrereqs</span><span class="operator">:</span><span class="text">
</span>                <span class="name">p</span><span class="operator">.</span><span class="name">delete</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>        <span class="name">curPrereqs</span> <span class="operator">=</span> <span class="name">quiz1</span><span class="operator">.</span><span class="name">prerequisites</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>        <span class="keyword">for</span> <span class="name">p</span> <span class="keyword">in</span> <span class="name">curPrereqs</span><span class="operator">:</span><span class="text">
</span>                <span class="name">newPrereq</span> <span class="operator">=</span> <span class="name">Prerequisite</span><span class="operator">(</span><span class="name">containingQuiz</span> <span class="operator">=</span> <span class="name">quiz2</span><span class="operator">,</span> <span class="name">requiredQuiz</span> <span class="operator">=</span> <span class="name">p</span><span class="operator">.</span><span class="name">requiredQuiz</span><span class="operator">)</span><span class="text">
</span>                <span class="name">newPrereq</span><span class="operator">.</span><span class="name">save</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span>        <span class="comment"># Copy Paths
</span>        <span class="name">curPaths</span> <span class="operator">=</span> <span class="name">quiz2</span><span class="operator">.</span><span class="name">paths</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>        <span class="keyword">for</span> <span class="name">p</span> <span class="keyword">in</span> <span class="name">curPaths</span><span class="operator">:</span><span class="text">
</span>                <span class="name">p</span><span class="operator">.</span><span class="name">delete</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>        <span class="name">curPaths</span> <span class="operator">=</span> <span class="name">quiz1</span><span class="operator">.</span><span class="name">paths</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>        <span class="keyword">for</span> <span class="name">p</span> <span class="keyword">in</span> <span class="name">curPaths</span><span class="operator">:</span><span class="text">
</span>                <span class="name">newPath</span> <span class="operator">=</span> <span class="name">Path</span><span class="operator">(</span><span class="name">quiz</span> <span class="operator">=</span> <span class="name">quiz2</span><span class="operator">,</span> <span class="name">lowscore</span> <span class="operator">=</span> <span class="name">p</span><span class="operator">.</span><span class="name">lowscore</span><span class="operator">,</span> <span class="name">highscore</span> <span class="operator">=</span> <span class="name">p</span><span class="operator">.</span><span class="name">highscore</span><span class="operator">,</span> <span class="name">text</span> <span class="operator">=</span> <span class="name">p</span><span class="operator">.</span><span class="name">text</span><span class="operator">,</span> <span class="name">passed</span> <span class="operator">=</span> <span class="name">p</span><span class="operator">.</span><span class="name">passed</span><span class="operator">,</span> <span class="name">toPage</span> <span class="operator">=</span> <span class="name">p</span><span class="operator">.</span><span class="name">toPage</span><span class="operator">)</span><span class="text">
</span>                <span class="name">newPath</span><span class="operator">.</span><span class="name">save</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span>        <span class="comment"># Copy Questions
</span>        <span class="name">curQuestions</span> <span class="operator">=</span> <span class="name">quiz2</span><span class="operator">.</span><span class="name">questions</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>        <span class="keyword">for</span> <span class="name">q</span> <span class="keyword">in</span> <span class="name">curQuestions</span><span class="operator">:</span><span class="text">
</span>                <span class="name">removeQuestion</span><span class="operator">(</span><span class="name">q</span><span class="operator">)</span><span class="text">
</span>        <span class="name">curQuestions</span> <span class="operator">=</span> <span class="name">quiz1</span><span class="operator">.</span><span class="name">questions</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>        <span class="keyword">for</span> <span class="name">q</span> <span class="keyword">in</span> <span class="name">curQuestions</span><span class="operator">:</span><span class="text">
</span>                <span class="keyword">if</span> <span class="operator">(</span><span class="name">isMultipleChoiceQuestion</span><span class="operator">(</span><span class="name">q</span><span class="operator">)</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                        <span class="name">q</span> <span class="operator">=</span> <span class="name">q</span><span class="operator">.</span><span class="name">multiplechoicequestion</span><span class="text">
</span>                        <span class="name">newQ</span> <span class="operator">=</span> <span class="name">MultipleChoiceQuestion</span><span class="operator">(</span><span class="name">text</span> <span class="operator">=</span> <span class="name">q</span><span class="operator">.</span><span class="name">text</span><span class="operator">,</span> <span class="name">order</span> <span class="operator">=</span> <span class="name">q</span><span class="operator">.</span><span class="name">order</span><span class="operator">,</span> <span class="name">quiz</span> <span class="operator">=</span> <span class="name">quiz2</span><span class="operator">)</span><span class="text">
</span>                        <span class="name">newQ</span><span class="operator">.</span><span class="name">save</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>                        <span class="comment"># Copy Answers
</span>                        <span class="name">curAnswers</span> <span class="operator">=</span> <span class="name">q</span><span class="operator">.</span><span class="name">answers</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>                        <span class="keyword">for</span> <span class="name">a</span> <span class="keyword">in</span> <span class="name">curAnswers</span><span class="operator">:</span><span class="text">
</span>                                <span class="name">newA</span> <span class="operator">=</span> <span class="name">Answer</span><span class="operator">(</span><span class="name">question</span> <span class="operator">=</span> <span class="name">newQ</span><span class="operator">,</span> <span class="name">correct</span> <span class="operator">=</span> <span class="name">a</span><span class="operator">.</span><span class="name">correct</span><span class="operator">,</span> <span class="name">order</span> <span class="operator">=</span> <span class="name">a</span><span class="operator">.</span><span class="name">order</span><span class="operator">,</span> <span class="name">text</span> <span class="operator">=</span> <span class="name">a</span><span class="operator">.</span><span class="name">text</span><span class="operator">)</span><span class="text">
</span>                                <span class="name">newA</span><span class="operator">.</span><span class="name">save</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>                <span class="keyword">else</span><span class="operator">:</span><span class="text">
</span>                        <span class="name">q</span> <span class="operator">=</span> <span class="name">q</span><span class="operator">.</span><span class="name">codequestion</span><span class="text">
</span>                        <span class="name">newQ</span> <span class="operator">=</span> <span class="name">CodeQuestion</span><span class="operator">(</span><span class="name">text</span> <span class="operator">=</span> <span class="name">q</span><span class="operator">.</span><span class="name">text</span><span class="operator">,</span> <span class="name">order</span> <span class="operator">=</span> <span class="name">q</span><span class="operator">.</span><span class="name">order</span><span class="operator">,</span> <span class="name">quiz</span> <span class="operator">=</span> <span class="name">quiz2</span><span class="operator">,</span> <span class="name">beforeCode</span> <span class="operator">=</span> <span class="name">q</span><span class="operator">.</span><span class="name">beforeCode</span><span class="operator">,</span> <span class="name">showBeforeCode</span> <span class="operator">=</span> <span class="name">q</span><span class="operator">.</span><span class="name">showBeforeCode</span><span class="operator">,</span> <span class="name">editableCode</span> <span class="operator">=</span> <span class="name">q</span><span class="operator">.</span><span class="name">editableCode</span><span class="operator">,</span> <span class="name">afterCode</span> <span class="operator">=</span> <span class="name">q</span><span class="operator">.</span><span class="name">afterCode</span><span class="operator">,</span> <span class="name">showAfterCode</span> <span class="operator">=</span> <span class="name">q</span><span class="operator">.</span><span class="name">showAfterCode</span><span class="operator">,</span> <span class="name">expectedOutput</span> <span class="operator">=</span> <span class="name">q</span><span class="operator">.</span><span class="name">expectedOutput</span><span class="operator">)</span><span class="text">
</span>                        <span class="name">newQ</span><span class="operator">.</span><span class="name">save</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span>        <span class="name">quiz2</span><span class="operator">.</span><span class="name">save</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span><span class="notcovered"><span class="keyword">def</span> <span class="name">matchPath</span><span class="operator">(</span><span class="name">self</span><span class="operator">,</span> <span class="name">score</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span>        <span class="string">'''
                This function takes a quiz and a "score" on the quiz, represented as a percentage,
                and returns the quiz path that the score matches. If no matching path
                is found, it raises the NoMatchingPath exception.

                @author Evan Kleist
        '''</span><span class="text">
</span>        <span class="name">paths</span> <span class="operator">=</span> <span class="name">self</span><span class="operator">.</span><span class="name">paths</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span>        <span class="keyword">for</span> <span class="name">p</span> <span class="keyword">in</span> <span class="name">paths</span><span class="operator">:</span><span class="text">
</span>                <span class="keyword">if</span> <span class="operator">(</span><span class="name">score</span> <span class="operator">&gt;=</span> <span class="name">p</span><span class="operator">.</span><span class="name">lowscore</span> <span class="keyword">and</span> <span class="name">score</span> <span class="operator">&lt;</span> <span class="name">p</span><span class="operator">.</span><span class="name">highscore</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                        <span class="keyword">return</span> <span class="name">p</span><span class="text">
</span>                <span class="keyword">if</span> <span class="operator">(</span><span class="name">score</span> <span class="operator">==</span> <span class="name">p</span><span class="operator">.</span><span class="name">highscore</span> <span class="keyword">and</span> <span class="name">score</span> <span class="operator">==</span> <span class="number">100</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                        <span class="keyword">return</span> <span class="name">p</span><span class="text">
</span><span class="text">
</span>        <span class="keyword">raise</span> <span class="name">NoMatchingPath</span><span class="text">
</span><span class="text">
</span><span class="notcovered"><span class="keyword">def</span> <span class="name">editPath</span><span class="operator">(</span><span class="name">self</span><span class="operator">,</span> <span class="name">request</span><span class="operator">,</span> <span class="name">course_slug</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span>        <span class="string">'''
                Takes a working copy of a quiz, a request containing post data, and a course_slug
                and edits the matching path of the quiz

                @author Evan Kleist
        '''</span><span class="text">
</span>        <span class="name">errors</span> <span class="operator">=</span> <span class="operator">[</span><span class="operator">]</span><span class="text">
</span>        <span class="name">path</span> <span class="operator">=</span> <span class="name">int</span><span class="operator">(</span><span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">[</span><span class="string">"path"</span><span class="operator">]</span><span class="operator">)</span><span class="text">
</span>        <span class="name">path</span> <span class="operator">=</span> <span class="name">self</span><span class="operator">.</span><span class="name">paths</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">lowscore</span><span class="operator">=</span><span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">[</span><span class="string">"path"</span><span class="operator">]</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span>        <span class="keyword">try</span><span class="operator">:</span><span class="text">
</span>                <span class="name">lowScore</span> <span class="operator">=</span> <span class="name">int</span><span class="operator">(</span><span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">[</span><span class="string">"LowScore"</span><span class="operator">]</span><span class="operator">)</span><span class="text">
</span>                <span class="keyword">if</span> <span class="operator">(</span><span class="name">lowScore</span> <span class="operator">&lt;</span> <span class="number">0</span> <span class="keyword">or</span> <span class="name">lowScore</span> <span class="operator">&gt;</span> <span class="number">100</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                        <span class="name">errors</span><span class="operator">.</span><span class="name">append</span><span class="operator">(</span><span class="string">"Low Score must be between 0 and 100"</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span>                <span class="keyword">try</span><span class="operator">:</span><span class="text">
</span>                        <span class="name">matchingPath</span> <span class="operator">=</span> <span class="name">matchPath</span><span class="operator">(</span><span class="name">self</span><span class="operator">,</span> <span class="name">lowScore</span><span class="operator">)</span><span class="text">
</span>                        <span class="keyword">if</span> <span class="operator">(</span><span class="name">matchingPath</span> <span class="operator">!=</span> <span class="name">path</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                                <span class="name">errors</span><span class="operator">.</span><span class="name">append</span><span class="operator">(</span><span class="string">"A path that matches this range exists already"</span><span class="operator">)</span><span class="text">
</span>                <span class="keyword">except</span> <span class="name">NoMatchingPath</span><span class="operator">:</span><span class="text">
</span>                        <span class="keyword">pass</span>                    <span class="text">
</span>        <span class="keyword">except</span> <span class="name">ValueError</span><span class="operator">:</span><span class="text">
</span>                <span class="name">lowScore</span> <span class="operator">=</span> <span class="number">0</span><span class="text">
</span>                <span class="name">errors</span><span class="operator">.</span><span class="name">append</span><span class="operator">(</span><span class="string">"Low Score must be an integer"</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span>        <span class="keyword">try</span><span class="operator">:</span><span class="text">
</span>                <span class="name">highScore</span> <span class="operator">=</span> <span class="name">int</span><span class="operator">(</span><span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">[</span><span class="string">"HighScore"</span><span class="operator">]</span><span class="operator">)</span><span class="text">
</span>                <span class="keyword">if</span> <span class="operator">(</span><span class="name">highScore</span> <span class="operator">&lt;</span> <span class="number">0</span> <span class="keyword">or</span> <span class="name">highScore</span> <span class="operator">&gt;</span> <span class="number">100</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                        <span class="name">errors</span><span class="operator">.</span><span class="name">append</span><span class="operator">(</span><span class="string">"High Score must be between 0 and 100"</span><span class="operator">)</span><span class="text">
</span>                <span class="keyword">if</span> <span class="operator">(</span><span class="name">highScore</span> <span class="operator">&lt;</span> <span class="name">lowScore</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                        <span class="name">errors</span><span class="operator">.</span><span class="name">append</span><span class="operator">(</span><span class="string">"Low Score must be less than or equal too High Score"</span><span class="operator">)</span><span class="text">
</span>        <span class="keyword">except</span> <span class="name">ValueError</span><span class="operator">:</span><span class="text">
</span>                <span class="name">errors</span><span class="operator">.</span><span class="name">append</span><span class="operator">(</span><span class="string">"High Score must be an integer"</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span>        <span class="keyword">if</span> <span class="operator">(</span><span class="name">path</span><span class="operator">.</span><span class="name">passed</span> <span class="operator">==</span> <span class="name">True</span> <span class="keyword">and</span> <span class="keyword">not</span> <span class="string">"passing"</span> <span class="keyword">in</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                <span class="comment"># Trying to change a path to go from passing to not passing
</span>                <span class="comment"># If other quizzes require this quiz as a prerequisite,
</span>                <span class="comment"># make sure an alternate passing path is available
</span>                <span class="name">paths</span> <span class="operator">=</span> <span class="name">self</span><span class="operator">.</span><span class="name">paths</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>                <span class="name">otherPassing</span> <span class="operator">=</span> <span class="name">False</span><span class="text">
</span>                <span class="keyword">for</span> <span class="name">p</span> <span class="keyword">in</span> <span class="name">paths</span><span class="operator">:</span><span class="text">
</span>                        <span class="keyword">if</span> <span class="operator">(</span><span class="name">p</span><span class="operator">.</span><span class="name">passed</span> <span class="keyword">and</span> <span class="name">p</span><span class="operator">.</span><span class="name">lowscore</span> <span class="operator">!=</span> <span class="name">path</span><span class="operator">.</span><span class="name">lowscore</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                                <span class="name">otherPassing</span> <span class="operator">=</span> <span class="name">True</span><span class="text">
</span>                <span class="keyword">if</span> <span class="operator">(</span><span class="name">otherPassing</span> <span class="operator">==</span> <span class="name">False</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                        <span class="comment"># No passing path so make sure no quizzes require it as a prerequisite
</span>                        <span class="name">course</span> <span class="operator">=</span> <span class="name">self</span><span class="operator">.</span><span class="name">course</span><span class="text">
</span>                        <span class="keyword">for</span> <span class="name">quiz</span> <span class="keyword">in</span> <span class="name">course</span><span class="operator">.</span><span class="name">pages</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                                <span class="keyword">try</span><span class="operator">:</span><span class="text">
</span>                                        <span class="name">quiz</span> <span class="operator">=</span> <span class="name">quiz</span><span class="operator">.</span><span class="name">quiz</span><span class="text">
</span>                                        <span class="keyword">if</span> <span class="operator">(</span><span class="name">quiz</span><span class="operator">.</span><span class="name">slug</span> <span class="operator">==</span> <span class="name">safeSlug</span><span class="operator">(</span><span class="name">quiz</span><span class="operator">.</span><span class="name">slug</span><span class="operator">)</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                                                <span class="name">prereqs</span> <span class="operator">=</span> <span class="name">quiz</span><span class="operator">.</span><span class="name">prerequisites</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>                                                <span class="keyword">for</span> <span class="name">p</span> <span class="keyword">in</span> <span class="name">prereqs</span><span class="operator">:</span><span class="text">
</span>                                                        <span class="keyword">if</span> <span class="operator">(</span><span class="name">p</span><span class="operator">.</span><span class="name">requiredQuiz</span><span class="operator">.</span><span class="name">slug</span> <span class="operator">==</span> <span class="name">safeSlug</span><span class="operator">(</span><span class="name">self</span><span class="operator">.</span><span class="name">slug</span><span class="operator">)</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                                                                <span class="comment"># A quiz requires this quiz as a prerequisite
</span>                                                                <span class="comment"># and no pathing pass exists, error
</span>                                                                <span class="name">errors</span><span class="operator">.</span><span class="name">append</span><span class="operator">(</span><span class="name">quiz</span><span class="operator">.</span><span class="name">name</span> <span class="operator">+</span> <span class="string">" requires this quiz as a prerequisite and no other passing path exists"</span><span class="operator">)</span><span class="text">
</span>                                <span class="keyword">except</span> <span class="name">Quiz</span><span class="operator">.</span><span class="name">DoesNotExist</span><span class="operator">:</span><span class="text">
</span>                                        <span class="keyword">pass</span><span class="text">
</span><span class="text">
</span>        <span class="name">course</span> <span class="operator">=</span> <span class="name">Course</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">slug</span><span class="operator">=</span><span class="name">course_slug</span><span class="operator">)</span><span class="text">
</span>        <span class="keyword">if</span> <span class="operator">(</span><span class="name">len</span><span class="operator">(</span><span class="name">errors</span><span class="operator">)</span> <span class="operator">==</span> <span class="number">0</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                <span class="name">path</span><span class="operator">.</span><span class="name">lowscore</span> <span class="operator">=</span> <span class="name">lowScore</span><span class="text">
</span>                <span class="name">path</span><span class="operator">.</span><span class="name">highscore</span> <span class="operator">=</span> <span class="name">highScore</span><span class="text">
</span>                <span class="name">path</span><span class="operator">.</span><span class="name">toPage</span> <span class="operator">=</span> <span class="name">course</span><span class="operator">.</span><span class="name">pages</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">slug</span><span class="operator">=</span><span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">[</span><span class="string">"pathPage"</span><span class="operator">]</span><span class="operator">)</span><span class="text">
</span>                <span class="name">path</span><span class="operator">.</span><span class="name">text</span> <span class="operator">=</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">[</span><span class="string">"dialogue"</span><span class="operator">]</span><span class="text">
</span>                <span class="name">path</span><span class="operator">.</span><span class="name">passed</span> <span class="operator">=</span> <span class="string">"passing"</span> <span class="keyword">in</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="text">
</span>                <span class="name">path</span><span class="operator">.</span><span class="name">save</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>                <span class="name">publishedCopy</span> <span class="operator">=</span> <span class="name">Quiz</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">slug</span> <span class="operator">=</span> <span class="name">safeSlug</span><span class="operator">(</span><span class="name">self</span><span class="operator">.</span><span class="name">slug</span><span class="operator">)</span><span class="operator">,</span> <span class="name">course</span><span class="operator">=</span><span class="name">course</span><span class="operator">)</span><span class="text">
</span>                <span class="name">publishedCopy</span><span class="operator">.</span><span class="name">upToDate</span> <span class="operator">=</span> <span class="name">False</span><span class="text">
</span>                <span class="name">publishedCopy</span><span class="operator">.</span><span class="name">save</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>        <span class="text">
</span>        <span class="keyword">return</span> <span class="name">errors</span><span class="text">
</span><span class="text">
</span><span class="notcovered"><span class="keyword">def</span> <span class="name">publishQuiz</span><span class="operator">(</span><span class="name">self</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">        <span class="string">''' 
                Takes a working copy of a quiz and copies it over to the published copy

                @author Evan Kleist
        '''</span></span><span class="text">
</span><span class="notcovered">        <span class="name">errors</span> <span class="operator">=</span> <span class="name">validateQuiz</span><span class="operator">(</span><span class="name">self</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">        <span class="keyword">if</span> <span class="operator">(</span><span class="name">len</span><span class="operator">(</span><span class="name">errors</span><span class="operator">)</span> <span class="operator">==</span> <span class="number">0</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                <span class="name">publishedSlug</span> <span class="operator">=</span> <span class="name">safeSlug</span><span class="operator">(</span><span class="name">self</span><span class="operator">.</span><span class="name">slug</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                <span class="name">publishedQuiz</span> <span class="operator">=</span> <span class="name">Quiz</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">slug</span><span class="operator">=</span><span class="name">publishedSlug</span><span class="operator">,</span> <span class="name">course</span><span class="operator">=</span><span class="name">self</span><span class="operator">.</span><span class="name">course</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                <span class="name">copyQuiz</span><span class="operator">(</span><span class="name">self</span><span class="operator">,</span> <span class="name">publishedQuiz</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                <span class="name">publishedQuiz</span><span class="operator">.</span><span class="name">upToDate</span> <span class="operator">=</span> <span class="name">True</span></span><span class="text">
</span><span class="notcovered">                <span class="name">publishedQuiz</span><span class="operator">.</span><span class="name">save</span><span class="operator">(</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">        <span class="keyword">return</span> <span class="name">errors</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered"><span class="keyword">def</span> <span class="name">removePath</span><span class="operator">(</span><span class="name">self</span><span class="operator">,</span> <span class="name">request</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span>        <span class="string">'''
                Takes a working copy of a quiz and a request containing post data and
                removes the path from the quiz

                @author Evan Kleist
        '''</span><span class="text">
</span>        <span class="name">errors</span> <span class="operator">=</span> <span class="operator">[</span><span class="operator">]</span><span class="text">
</span>        <span class="name">course</span> <span class="operator">=</span> <span class="name">self</span><span class="operator">.</span><span class="name">course</span><span class="text">
</span>        <span class="name">path</span> <span class="operator">=</span> <span class="name">self</span><span class="operator">.</span><span class="name">paths</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">lowscore</span> <span class="operator">=</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">[</span><span class="string">"path"</span><span class="operator">]</span><span class="operator">)</span><span class="text">
</span>        <span class="comment"># See if there is still a passing path
</span>        <span class="name">paths</span> <span class="operator">=</span> <span class="name">self</span><span class="operator">.</span><span class="name">paths</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>        <span class="name">passingPath</span> <span class="operator">=</span> <span class="name">False</span><span class="text">
</span>        <span class="keyword">for</span> <span class="name">p</span> <span class="keyword">in</span> <span class="name">paths</span><span class="operator">:</span><span class="text">
</span>                <span class="keyword">if</span> <span class="operator">(</span><span class="name">p</span><span class="operator">.</span><span class="name">passed</span> <span class="operator">==</span> <span class="name">True</span> <span class="keyword">and</span> <span class="keyword">not</span> <span class="name">p</span><span class="operator">.</span><span class="name">lowscore</span> <span class="operator">==</span> <span class="name">path</span><span class="operator">.</span><span class="name">lowscore</span> <span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                        <span class="name">passingPath</span> <span class="operator">=</span> <span class="name">True</span><span class="text">
</span>        <span class="text">
</span>        <span class="keyword">if</span> <span class="operator">(</span><span class="name">passingPath</span> <span class="operator">==</span> <span class="name">False</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                <span class="comment"># No passing path so make sure no quizzes require it as a prerequisite
</span><span class="notcovered">                <span class="keyword">for</span> <span class="name">quiz</span> <span class="keyword">in</span> <span class="name">course</span><span class="operator">.</span><span class="name">pages</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                        <span class="keyword">try</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                                <span class="name">quiz</span> <span class="operator">=</span> <span class="name">quiz</span><span class="operator">.</span><span class="name">quiz</span></span><span class="text">
</span><span class="notcovered">                                <span class="keyword">if</span> <span class="operator">(</span><span class="name">quiz</span><span class="operator">.</span><span class="name">slug</span> <span class="operator">==</span> <span class="name">safeSlug</span><span class="operator">(</span><span class="name">quiz</span><span class="operator">.</span><span class="name">slug</span><span class="operator">)</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                                        <span class="name">prereqs</span> <span class="operator">=</span> <span class="name">quiz</span><span class="operator">.</span><span class="name">prerequisites</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                                        <span class="keyword">for</span> <span class="name">p</span> <span class="keyword">in</span> <span class="name">prereqs</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                                                <span class="keyword">if</span> <span class="operator">(</span><span class="name">p</span><span class="operator">.</span><span class="name">requiredQuiz</span><span class="operator">.</span><span class="name">slug</span> <span class="operator">==</span> <span class="name">safeSlug</span><span class="operator">(</span><span class="name">self</span><span class="operator">.</span><span class="name">slug</span><span class="operator">)</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                                                        <span class="comment"># A quiz requires this quiz as a prerequisite
</span>                                                        <span class="comment"># and no pathing pass exists, error
</span>                                                        <span class="name">errors</span><span class="operator">.</span><span class="name">append</span><span class="operator">(</span><span class="name">quiz</span><span class="operator">.</span><span class="name">name</span> <span class="operator">+</span> <span class="string">" requires this quiz as a prerequisite and no other passing path exists"</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                        <span class="keyword">except</span> <span class="name">Quiz</span><span class="operator">.</span><span class="name">DoesNotExist</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                                <span class="keyword">pass</span></span><span class="text">
</span><span class="text">
</span>        <span class="keyword">if</span> <span class="operator">(</span><span class="name">len</span><span class="operator">(</span><span class="name">errors</span><span class="operator">)</span> <span class="operator">==</span> <span class="number">0</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                <span class="name">path</span><span class="operator">.</span><span class="name">delete</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>                <span class="name">publishedCopy</span> <span class="operator">=</span> <span class="name">Quiz</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">slug</span> <span class="operator">=</span> <span class="name">safeSlug</span><span class="operator">(</span><span class="name">self</span><span class="operator">.</span><span class="name">slug</span><span class="operator">)</span><span class="operator">,</span> <span class="name">course</span><span class="operator">=</span><span class="name">course</span><span class="operator">)</span><span class="text">
</span>                <span class="name">publishedCopy</span><span class="operator">.</span><span class="name">upToDate</span> <span class="operator">=</span> <span class="name">False</span><span class="text">
</span>                <span class="name">publishedCopy</span><span class="operator">.</span><span class="name">save</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span>        <span class="keyword">return</span> <span class="name">errors</span><span class="text">
</span><span class="text">
</span><span class="notcovered"><span class="keyword">def</span> <span class="name">removeQuiz</span><span class="operator">(</span><span class="name">self</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span>        <span class="string">'''
                Removes a quiz from the database, as well as all related 
                objects

                @author Evan Kleist
        '''</span><span class="text">
</span>        <span class="name">questions</span> <span class="operator">=</span> <span class="name">self</span><span class="operator">.</span><span class="name">questions</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>        <span class="name">prerequisites</span> <span class="operator">=</span> <span class="name">self</span><span class="operator">.</span><span class="name">prerequisites</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>        <span class="name">paths</span> <span class="operator">=</span> <span class="name">self</span><span class="operator">.</span><span class="name">paths</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>        <span class="name">workingQuiz</span> <span class="operator">=</span> <span class="name">Quiz</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">slug</span><span class="operator">=</span><span class="operator">(</span><span class="name">self</span><span class="operator">.</span><span class="name">slug</span> <span class="operator">+</span> <span class="string">"_workingCopy"</span><span class="operator">)</span><span class="operator">,</span> <span class="name">course</span><span class="operator">=</span><span class="name">self</span><span class="operator">.</span><span class="name">course</span><span class="operator">)</span><span class="text">
</span>        <span class="name">workingQuestions</span> <span class="operator">=</span> <span class="name">workingQuiz</span><span class="operator">.</span><span class="name">questions</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>        <span class="name">workingPrerequisites</span> <span class="operator">=</span> <span class="name">workingQuiz</span><span class="operator">.</span><span class="name">prerequisites</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>        <span class="name">workingPaths</span> <span class="operator">=</span> <span class="name">workingQuiz</span><span class="operator">.</span><span class="name">paths</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span>        <span class="comment"># Remove Questions
</span>        <span class="keyword">for</span> <span class="name">q</span> <span class="keyword">in</span> <span class="name">questions</span><span class="operator">:</span><span class="text">
</span><span class="notcovered">                <span class="name">removeQuestion</span><span class="operator">(</span><span class="name">q</span><span class="operator">)</span></span><span class="text">
</span>        <span class="keyword">for</span> <span class="name">q</span> <span class="keyword">in</span> <span class="name">workingQuestions</span><span class="operator">:</span><span class="text">
</span><span class="notcovered">                <span class="name">removeQuestion</span><span class="operator">(</span><span class="name">q</span><span class="operator">)</span></span><span class="text">
</span><span class="text">
</span>        <span class="comment"># Remove Prerequisites
</span>        <span class="keyword">for</span> <span class="name">p</span> <span class="keyword">in</span> <span class="name">prerequisites</span><span class="operator">:</span><span class="text">
</span><span class="notcovered">                <span class="name">p</span><span class="operator">.</span><span class="name">delete</span><span class="operator">(</span><span class="operator">)</span></span><span class="text">
</span>        <span class="keyword">for</span> <span class="name">p</span> <span class="keyword">in</span> <span class="name">workingPrerequisites</span><span class="operator">:</span><span class="text">
</span><span class="notcovered">                <span class="name">p</span><span class="operator">.</span><span class="name">delete</span><span class="operator">(</span><span class="operator">)</span></span><span class="text">
</span><span class="text">
</span>        <span class="comment"># Remove Paths
</span>        <span class="keyword">for</span> <span class="name">p</span> <span class="keyword">in</span> <span class="name">paths</span><span class="operator">:</span><span class="text">
</span><span class="notcovered">                <span class="name">p</span><span class="operator">.</span><span class="name">delete</span><span class="operator">(</span><span class="operator">)</span></span><span class="text">
</span>        <span class="keyword">for</span> <span class="name">p</span> <span class="keyword">in</span> <span class="name">workingPaths</span><span class="operator">:</span><span class="text">
</span><span class="notcovered">                <span class="name">p</span><span class="operator">.</span><span class="name">delete</span><span class="operator">(</span><span class="operator">)</span></span><span class="text">
</span><span class="text">
</span>        <span class="comment"># Remove Pages
</span>        <span class="name">removePage</span><span class="operator">(</span><span class="name">self</span><span class="operator">)</span><span class="text">
</span>        <span class="name">workingQuiz</span><span class="operator">.</span><span class="name">delete</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>        <span class="comment"># should also remove all associated quiz objects such as stats, questions, answers, paths
</span>        <span class="keyword">return</span> <span class="number">0</span><span class="text">
</span><span class="text">
</span><span class="notcovered"><span class="keyword">def</span> <span class="name">reorderQuestions</span><span class="operator">(</span><span class="name">self</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span>        <span class="string">'''
                Takes a quiz, retrieves its questions, and then reorders the 
                questions into a valid state.

                @author Evan Kleist
        '''</span><span class="text">
</span>        <span class="name">questions</span> <span class="operator">=</span> <span class="name">self</span><span class="operator">.</span><span class="name">questions</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span><span class="operator">.</span><span class="name">order_by</span><span class="operator">(</span><span class="string">"order"</span><span class="operator">)</span><span class="text">
</span>        <span class="name">qNum</span> <span class="operator">=</span> <span class="number">1</span><span class="text">
</span>        <span class="keyword">for</span> <span class="name">q</span> <span class="keyword">in</span> <span class="name">questions</span><span class="operator">:</span><span class="text">
</span>                <span class="name">q</span><span class="operator">.</span><span class="name">order</span> <span class="operator">=</span> <span class="name">qNum</span><span class="text">
</span>                <span class="name">q</span><span class="operator">.</span><span class="name">save</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>                <span class="name">qNum</span> <span class="operator">=</span> <span class="name">qNum</span> <span class="operator">+</span> <span class="number">1</span><span class="text">
</span>        <span class="comment"># Sanity check to make sure the question ordering is still valid
</span>        <span class="keyword">if</span> <span class="operator">(</span><span class="name">validateQuestionOrder</span><span class="operator">(</span><span class="name">self</span><span class="operator">)</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                <span class="keyword">return</span> <span class="number">0</span><span class="text">
</span><span class="notcovered">        <span class="keyword">return</span> <span class="operator">-</span><span class="number">1</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered"><span class="keyword">def</span> <span class="name">revertQuiz</span><span class="operator">(</span><span class="name">self</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span>        <span class="string">'''
                Takes a working copy of a quiz and reverts it to its published version

                @author Evan Kleist
        '''</span><span class="text">
</span>        <span class="name">publishedSlug</span> <span class="operator">=</span> <span class="name">safeSlug</span><span class="operator">(</span><span class="name">self</span><span class="operator">.</span><span class="name">slug</span><span class="operator">)</span><span class="text">
</span>        <span class="name">publishedQuiz</span> <span class="operator">=</span> <span class="name">Quiz</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">slug</span><span class="operator">=</span><span class="name">publishedSlug</span><span class="operator">,</span> <span class="name">course</span><span class="operator">=</span><span class="name">self</span><span class="operator">.</span><span class="name">course</span><span class="operator">)</span><span class="text">
</span>        <span class="text">
</span>        <span class="name">copyQuiz</span><span class="operator">(</span><span class="name">publishedQuiz</span><span class="operator">,</span> <span class="name">self</span><span class="operator">)</span><span class="text">
</span>        <span class="name">publishedQuiz</span><span class="operator">.</span><span class="name">upToDate</span> <span class="operator">=</span> <span class="name">True</span><span class="text">
</span>        <span class="name">publishedQuiz</span><span class="operator">.</span><span class="name">save</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span><span class="text">
</span><span class="notcovered"><span class="keyword">def</span> <span class="name">safeSlug</span><span class="operator">(</span><span class="name">page_slug</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span>        <span class="string">'''
                Takes a quiz slug and makes sure they are not trying to directly access
                the working copy. If so, it returns the slug to the published copy

                @author Evan Kleist
        '''</span><span class="text">
</span><span class="text">
</span>        <span class="keyword">if</span> <span class="operator">(</span><span class="name">page_slug</span><span class="operator">.</span><span class="name">endswith</span><span class="operator">(</span><span class="string">"_workingCopy"</span><span class="operator">)</span> <span class="operator">!=</span> <span class="name">False</span> <span class="keyword">and</span> <span class="name">page_slug</span><span class="operator">.</span><span class="name">find</span><span class="operator">(</span><span class="string">"_workingCopy"</span><span class="operator">)</span> <span class="operator">&lt;=</span> <span class="name">len</span><span class="operator">(</span><span class="name">page_slug</span><span class="operator">)</span> <span class="operator">-</span> <span class="number">12</span> <span class="keyword">and</span> <span class="name">page_slug</span> <span class="operator">!=</span> <span class="string">"_workingCopy"</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                <span class="keyword">return</span> <span class="name">page_slug</span><span class="operator">[</span><span class="operator">:</span><span class="operator">-</span><span class="number">12</span><span class="operator">]</span><span class="text">
</span><span class="text">
</span>        <span class="keyword">return</span> <span class="name">page_slug</span><span class="text">
</span>                <span class="text">
</span><span class="text">
</span><span class="notcovered"><span class="keyword">def</span> <span class="name">saveQuiz</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="name">course_slug</span><span class="operator">,</span> <span class="name">pid</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span>        <span class="string">'''
                Takes a request, a course, and a page id. It then pulls the 
                quiz from the post data and updates the elements in the 
                database. Before saving, it validates for proper data

                @author Evan Kleist
        '''</span><span class="text">
</span>        <span class="name">data</span> <span class="operator">=</span> <span class="operator">{</span><span class="operator">}</span><span class="text">
</span>        <span class="name">errors</span> <span class="operator">=</span> <span class="operator">[</span><span class="operator">]</span><span class="text">
</span>        <span class="name">course</span> <span class="operator">=</span> <span class="name">Course</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">slug</span> <span class="operator">=</span> <span class="name">course_slug</span><span class="operator">)</span><span class="text">
</span>        <span class="name">quiz</span> <span class="operator">=</span> <span class="name">Page</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">slug</span><span class="operator">=</span><span class="operator">(</span><span class="name">pid</span> <span class="operator">+</span> <span class="string">"_workingCopy"</span><span class="operator">)</span><span class="operator">,</span> <span class="name">course</span><span class="operator">=</span><span class="name">course</span><span class="operator">)</span><span class="operator">.</span><span class="name">quiz</span><span class="text">
</span>        <span class="name">publishedQuiz</span> <span class="operator">=</span> <span class="name">Page</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">slug</span><span class="operator">=</span><span class="name">pid</span><span class="operator">,</span> <span class="name">course</span><span class="operator">=</span><span class="name">course</span><span class="operator">)</span><span class="operator">.</span><span class="name">quiz</span><span class="text">
</span><span class="text">
</span>        <span class="comment"># Title - Make sure its not a duplicate in the course
</span>        <span class="keyword">try</span><span class="operator">:</span><span class="text">
</span>                <span class="name">quiz2</span> <span class="operator">=</span> <span class="name">Quiz</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">slug</span><span class="operator">=</span><span class="name">slugify</span><span class="operator">(</span><span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">[</span><span class="string">"quizTitle"</span><span class="operator">]</span><span class="operator">)</span> <span class="operator">+</span> <span class="string">"_workingCopy"</span><span class="operator">,</span> <span class="name">course</span><span class="operator">=</span><span class="name">course</span><span class="operator">)</span><span class="text">
</span>                <span class="keyword">if</span> <span class="operator">(</span><span class="name">quiz2</span><span class="operator">.</span><span class="name">pk</span> <span class="operator">!=</span> <span class="name">quiz</span><span class="operator">.</span><span class="name">pk</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                        <span class="name">errors</span><span class="operator">.</span><span class="name">append</span><span class="operator">(</span><span class="string">"Quiz Title already exists!"</span><span class="operator">)</span><span class="text">
</span>        <span class="keyword">except</span> <span class="name">Quiz</span><span class="operator">.</span><span class="name">DoesNotExist</span><span class="operator">:</span><span class="text">
</span>                <span class="keyword">pass</span><span class="text">
</span><span class="text">
</span>        <span class="comment"># Title - Make sure its not blank
</span>        <span class="keyword">if</span> <span class="operator">(</span><span class="name">len</span><span class="operator">(</span><span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">[</span><span class="string">"quizTitle"</span><span class="operator">]</span><span class="operator">)</span> <span class="operator">==</span> <span class="number">0</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                <span class="name">errors</span><span class="operator">.</span><span class="name">append</span><span class="operator">(</span><span class="string">"Quiz Title cannot be blank!"</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span>        <span class="keyword">if</span> <span class="operator">(</span><span class="name">len</span><span class="operator">(</span><span class="name">errors</span><span class="operator">)</span> <span class="operator">==</span> <span class="number">0</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                <span class="name">quiz</span><span class="operator">.</span><span class="name">text</span> <span class="operator">=</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">[</span><span class="string">"quizTitle"</span><span class="operator">]</span><span class="text">
</span>                <span class="name">quiz</span><span class="operator">.</span><span class="name">name</span> <span class="operator">=</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">[</span><span class="string">"quizTitle"</span><span class="operator">]</span><span class="text">
</span>                <span class="name">publishedQuiz</span><span class="operator">.</span><span class="name">slug</span> <span class="operator">=</span> <span class="name">slugify</span><span class="operator">(</span><span class="name">quiz</span><span class="operator">.</span><span class="name">name</span><span class="operator">)</span><span class="text">
</span>                <span class="name">quiz</span><span class="operator">.</span><span class="name">slug</span> <span class="operator">=</span> <span class="name">publishedQuiz</span><span class="operator">.</span><span class="name">slug</span> <span class="operator">+</span> <span class="string">"_workingCopy"</span><span class="text">
</span>                <span class="keyword">if</span> <span class="string">"hidden"</span> <span class="keyword">in</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">:</span><span class="text">
</span>                        <span class="name">quiz</span><span class="operator">.</span><span class="name">hidden</span> <span class="operator">=</span> <span class="name">True</span><span class="text">
</span>                <span class="keyword">else</span><span class="operator">:</span><span class="text">
</span><span class="notcovered">                        <span class="name">quiz</span><span class="operator">.</span><span class="name">hidden</span> <span class="operator">=</span> <span class="name">False</span></span><span class="text">
</span>                <span class="comment"># Delete current prerequisites
</span>                <span class="keyword">for</span> <span class="name">p</span> <span class="keyword">in</span> <span class="name">quiz</span><span class="operator">.</span><span class="name">prerequisites</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                        <span class="name">p</span><span class="operator">.</span><span class="name">delete</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>                <span class="keyword">if</span> <span class="string">"prereqs"</span> <span class="keyword">in</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">:</span><span class="text">
</span>                        <span class="comment"># Create prerequisites
</span><span class="notcovered">                        <span class="keyword">for</span> <span class="name">p</span> <span class="keyword">in</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">.</span><span class="name">getlist</span><span class="operator">(</span><span class="string">"prereqs"</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                                <span class="name">reqQuiz</span> <span class="operator">=</span> <span class="name">Course</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">slug</span><span class="operator">=</span><span class="name">course_slug</span><span class="operator">)</span><span class="operator">.</span><span class="name">pages</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">slug</span><span class="operator">=</span><span class="name">p</span><span class="operator">)</span><span class="operator">.</span><span class="name">quiz</span></span><span class="text">
</span><span class="notcovered">                                <span class="name">newPrereq</span> <span class="operator">=</span> <span class="name">Prerequisite</span><span class="operator">(</span><span class="name">containingQuiz</span><span class="operator">=</span><span class="name">quiz</span><span class="operator">,</span> <span class="name">requiredQuiz</span><span class="operator">=</span><span class="name">reqQuiz</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                                <span class="name">newPrereq</span><span class="operator">.</span><span class="name">save</span><span class="operator">(</span><span class="operator">)</span></span><span class="text">
</span>                        <span class="text">
</span>                <span class="name">questions</span> <span class="operator">=</span> <span class="name">quiz</span><span class="operator">.</span><span class="name">questions</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>                <span class="keyword">for</span> <span class="name">q</span> <span class="keyword">in</span> <span class="name">questions</span><span class="operator">:</span><span class="text">
</span>                        <span class="keyword">if</span> <span class="operator">(</span><span class="name">isMultipleChoiceQuestion</span><span class="operator">(</span><span class="name">q</span><span class="operator">)</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                                <span class="name">q</span> <span class="operator">=</span> <span class="name">q</span><span class="operator">.</span><span class="name">multiplechoicequestion</span><span class="text">
</span>                                <span class="keyword">for</span> <span class="name">a</span> <span class="keyword">in</span> <span class="name">q</span><span class="operator">.</span><span class="name">answers</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                                        <span class="name">a</span><span class="operator">.</span><span class="name">text</span> <span class="operator">=</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">[</span><span class="string">'mcq%sa%s'</span> <span class="operator">%</span> <span class="operator">(</span><span class="name">q</span><span class="operator">.</span><span class="name">order</span><span class="operator">,</span> <span class="name">a</span><span class="operator">.</span><span class="name">order</span><span class="operator">)</span><span class="operator">]</span><span class="text">
</span>                                        <span class="name">a</span><span class="operator">.</span><span class="name">correct</span> <span class="operator">=</span> <span class="operator">(</span><span class="operator">(</span><span class="string">"mcq%sac"</span> <span class="operator">%</span> <span class="name">q</span><span class="operator">.</span><span class="name">order</span><span class="operator">)</span> <span class="keyword">in</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span> <span class="keyword">and</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">[</span><span class="string">"mcq%sac"</span> <span class="operator">%</span> <span class="name">q</span><span class="operator">.</span><span class="name">order</span><span class="operator">]</span> <span class="operator">==</span> <span class="name">str</span><span class="operator">(</span><span class="name">a</span><span class="operator">.</span><span class="name">order</span><span class="operator">)</span><span class="operator">)</span><span class="text">
</span>                                        <span class="name">a</span><span class="operator">.</span><span class="name">save</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>                                <span class="name">q</span><span class="operator">.</span><span class="name">text</span> <span class="operator">=</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">[</span><span class="string">'mcq%stext'</span> <span class="operator">%</span> <span class="name">q</span><span class="operator">.</span><span class="name">order</span><span class="operator">]</span><span class="text">
</span>                                <span class="name">q</span><span class="operator">.</span><span class="name">order</span> <span class="operator">=</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">[</span><span class="string">'mcq%sorder'</span> <span class="operator">%</span> <span class="name">q</span><span class="operator">.</span><span class="name">order</span><span class="operator">]</span><span class="text">
</span>                        <span class="keyword">else</span><span class="operator">:</span><span class="text">
</span><span class="notcovered">                                <span class="name">q</span> <span class="operator">=</span> <span class="name">q</span><span class="operator">.</span><span class="name">codequestion</span></span><span class="text">
</span><span class="notcovered">                                <span class="name">q</span><span class="operator">.</span><span class="name">text</span> <span class="operator">=</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">[</span><span class="string">'cq%stext'</span> <span class="operator">%</span> <span class="name">q</span><span class="operator">.</span><span class="name">order</span><span class="operator">]</span></span><span class="text">
</span><span class="notcovered">                                <span class="name">q</span><span class="operator">.</span><span class="name">expectedOutput</span> <span class="operator">=</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">[</span><span class="string">'cq%seo'</span> <span class="operator">%</span> <span class="name">q</span><span class="operator">.</span><span class="name">order</span><span class="operator">]</span></span><span class="text">
</span><span class="notcovered">                                <span class="name">q</span><span class="operator">.</span><span class="name">order</span> <span class="operator">=</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">[</span><span class="string">'cq%sorder'</span> <span class="operator">%</span> <span class="name">q</span><span class="operator">.</span><span class="name">order</span><span class="operator">]</span></span><span class="text">
</span>                        <span class="name">q</span><span class="operator">.</span><span class="name">save</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span>                <span class="name">publishedQuiz</span><span class="operator">.</span><span class="name">upToDate</span> <span class="operator">=</span> <span class="name">False</span><span class="text">
</span>                <span class="name">quiz</span><span class="operator">.</span><span class="name">save</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>                <span class="name">publishedQuiz</span><span class="operator">.</span><span class="name">save</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span>        <span class="name">data</span> <span class="operator">=</span> <span class="operator">{</span><span class="string">"quiz_slug"</span><span class="operator">:</span><span class="name">publishedQuiz</span><span class="operator">.</span><span class="name">slug</span><span class="operator">,</span> <span class="string">"errors"</span><span class="operator">:</span><span class="name">errors</span><span class="operator">}</span><span class="text">
</span>        <span class="keyword">return</span> <span class="name">data</span><span class="text">
</span><span class="text">
</span><span class="notcovered"><span class="keyword">def</span> <span class="name">scoreQuiz</span><span class="operator">(</span><span class="name">self</span><span class="operator">,</span> <span class="name">request</span><span class="operator">,</span> <span class="name">course_slug</span><span class="operator">,</span> <span class="name">quiz_slug</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span>        <span class="string">'''
                Takes a quiz and a request. Pulls the submitted answers from 
                the form contained in the request and compares it to the 
                correct answers specified in the quiz. Generates a statistic 
                for a quiz, adds it to the database and returns their score.

                @author Evan Kleist
        '''</span><span class="text">
</span>        <span class="name">questions</span> <span class="operator">=</span> <span class="name">self</span><span class="operator">.</span><span class="name">questions</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>        <span class="name">course</span> <span class="operator">=</span> <span class="name">Course</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">slug</span><span class="operator">=</span><span class="name">course_slug</span><span class="operator">)</span><span class="text">
</span>        <span class="name">score</span> <span class="operator">=</span> <span class="number">0</span><span class="text">
</span><span class="text">
</span>        <span class="keyword">for</span> <span class="name">q</span> <span class="keyword">in</span> <span class="name">questions</span><span class="operator">:</span><span class="text">
</span>                <span class="keyword">if</span> <span class="operator">(</span><span class="name">isMultipleChoiceQuestion</span><span class="operator">(</span><span class="name">q</span><span class="operator">)</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                        <span class="name">q</span> <span class="operator">=</span> <span class="name">q</span><span class="operator">.</span><span class="name">multiplechoicequestion</span><span class="text">
</span>                        <span class="keyword">if</span> <span class="operator">(</span><span class="string">'mcq%s'</span> <span class="operator">%</span> <span class="name">q</span><span class="operator">.</span><span class="name">order</span><span class="operator">)</span> <span class="keyword">in</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">:</span><span class="text">
</span>                                <span class="name">theirAnswer</span> <span class="operator">=</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">[</span><span class="string">'mcq%s'</span> <span class="operator">%</span> <span class="name">q</span><span class="operator">.</span><span class="name">order</span><span class="operator">]</span><span class="text">
</span>                                <span class="keyword">if</span> <span class="operator">(</span><span class="name">q</span><span class="operator">.</span><span class="name">answers</span><span class="operator">.</span><span class="name">get</span><span class="operator">(</span><span class="name">order</span><span class="operator">=</span><span class="name">theirAnswer</span><span class="operator">)</span><span class="operator">.</span><span class="name">correct</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                                        <span class="name">score</span> <span class="operator">=</span> <span class="name">score</span> <span class="operator">+</span> <span class="number">1</span><span class="text">
</span>                <span class="keyword">else</span><span class="operator">:</span><span class="text">
</span><span class="notcovered">                        <span class="name">q</span> <span class="operator">=</span> <span class="name">q</span><span class="operator">.</span><span class="name">codequestion</span></span><span class="text">
</span><span class="notcovered">                        <span class="name">theirCode</span> <span class="operator">=</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">[</span><span class="string">'cq%s'</span> <span class="operator">%</span> <span class="name">q</span><span class="operator">.</span><span class="name">order</span><span class="operator">]</span></span><span class="text">
</span><span class="notcovered">                        <span class="name">expectedCode</span> <span class="operator">=</span> <span class="name">q</span><span class="operator">.</span><span class="name">expectedOutput</span></span><span class="text">
</span><span class="notcovered">                        <span class="keyword">try</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                                <span class="operator">(</span><span class="name">theirResult</span><span class="operator">,</span> <span class="name">scope</span><span class="operator">)</span> <span class="operator">=</span> <span class="name">evalPythonString</span><span class="operator">(</span><span class="name">theirCode</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                                <span class="operator">(</span><span class="name">expectedResult</span><span class="operator">,</span> <span class="name">scope</span><span class="operator">)</span> <span class="operator">=</span> <span class="name">evalPythonString</span><span class="operator">(</span><span class="name">expectedCode</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                                <span class="keyword">if</span> <span class="operator">(</span><span class="name">theirResult</span> <span class="operator">==</span> <span class="name">expectedResult</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                                        <span class="name">score</span> <span class="operator">=</span> <span class="name">score</span> <span class="operator">+</span> <span class="number">1</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered">                        <span class="keyword">except</span> <span class="name">SyntaxError</span><span class="operator">,</span> <span class="name">e</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                                <span class="comment"># Need to do something helpful, doing nothing for now
</span>                                <span class="keyword">pass</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered">                        <span class="keyword">except</span> <span class="name">Exception</span><span class="operator">,</span> <span class="name">e</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                                <span class="comment"># Need to do something helpful as well, doing nothing for now
</span>                                <span class="keyword">pass</span></span><span class="text">
</span>                        <span class="text">
</span><span class="text">
</span>        <span class="keyword">if</span> <span class="operator">(</span><span class="name">request</span><span class="operator">.</span><span class="name">user</span> <span class="keyword">and</span> <span class="keyword">not</span> <span class="name">request</span><span class="operator">.</span><span class="name">user</span><span class="operator">.</span><span class="name">is_anonymous</span><span class="operator">(</span><span class="operator">)</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                <span class="name">Stat</span><span class="operator">.</span><span class="name">CreateStat</span><span class="operator">(</span><span class="name">course</span><span class="operator">,</span> <span class="name">self</span><span class="operator">,</span> <span class="name">request</span><span class="operator">.</span><span class="name">user</span><span class="operator">,</span> <span class="name">score</span><span class="operator">)</span><span class="text">
</span>        <span class="text">
</span>        <span class="keyword">return</span> <span class="name">score</span><span class="text">
</span><span class="text">
</span><span class="notcovered"><span class="keyword">def</span> <span class="name">validateQuestionOrder</span><span class="operator">(</span><span class="name">self</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span>        <span class="string">'''
                Takes in a quiz, and verifies that all of its questions have
                a unique ordering, and are ordered from 1 -&gt; # of questions

                Returns True if the above constraints are met, False otherwise

                @author Evan Kleist
        '''</span><span class="text">
</span>        <span class="text">
</span>        <span class="name">questions</span> <span class="operator">=</span> <span class="name">self</span><span class="operator">.</span><span class="name">questions</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>        <span class="name">usedNumbers</span> <span class="operator">=</span> <span class="name">set</span><span class="operator">(</span><span class="operator">[</span><span class="name">question</span><span class="operator">.</span><span class="name">order</span> <span class="keyword">for</span> <span class="name">question</span> <span class="keyword">in</span> <span class="name">questions</span><span class="operator">]</span><span class="operator">)</span><span class="text">
</span>        <span class="keyword">if</span> <span class="operator">(</span><span class="name">len</span><span class="operator">(</span><span class="name">questions</span><span class="operator">)</span> <span class="operator">==</span> <span class="number">0</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span><span class="notcovered">                <span class="keyword">return</span> <span class="name">True</span></span><span class="text">
</span>        <span class="keyword">if</span> <span class="name">len</span><span class="operator">(</span><span class="name">questions</span><span class="operator">)</span> <span class="operator">!=</span> <span class="name">len</span><span class="operator">(</span><span class="name">usedNumbers</span><span class="operator">)</span> <span class="keyword">or</span> \
                <span class="name">min</span><span class="operator">(</span><span class="name">usedNumbers</span><span class="operator">)</span> <span class="operator">!=</span> <span class="number">1</span> <span class="keyword">or</span> <span class="name">max</span><span class="operator">(</span><span class="name">usedNumbers</span><span class="operator">)</span> <span class="operator">!=</span> <span class="name">len</span><span class="operator">(</span><span class="name">questions</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                        <span class="keyword">return</span> <span class="name">False</span><span class="text">
</span>        <span class="keyword">return</span> <span class="name">True</span><span class="text">
</span><span class="text">
</span><span class="notcovered"><span class="keyword">def</span> <span class="name">validateQuiz</span><span class="operator">(</span><span class="name">self</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span>        <span class="string">'''
                Takes a working copy of a quiz and makes sure all of the data
                is valid. It returns an array containg the errors or an emtpy
                array if no errors were found
                
                @author Evan Kleist
        '''</span><span class="text">
</span>        <span class="name">errors</span> <span class="operator">=</span> <span class="operator">[</span><span class="operator">]</span><span class="text">
</span>        <span class="name">questions</span> <span class="operator">=</span> <span class="name">self</span><span class="operator">.</span><span class="name">questions</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>        <span class="text">
</span>        <span class="comment"># Title - Make sure its not blank
</span>        <span class="keyword">if</span> <span class="operator">(</span><span class="name">len</span><span class="operator">(</span><span class="name">self</span><span class="operator">.</span><span class="name">text</span><span class="operator">)</span> <span class="operator">==</span> <span class="number">0</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                <span class="name">errors</span><span class="operator">.</span><span class="name">append</span><span class="operator">(</span><span class="string">"Quiz Title can not be blank"</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span>        <span class="comment"># Hidden - There can be no errors in this
</span><span class="text">
</span>        <span class="comment"># Prerequisites - Make sure the required quiz(s) have a "passing" path
</span>        <span class="keyword">for</span> <span class="name">prereq</span> <span class="keyword">in</span> <span class="name">self</span><span class="operator">.</span><span class="name">prerequisites</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                <span class="name">requiredQuiz</span> <span class="operator">=</span> <span class="name">prereq</span><span class="operator">.</span><span class="name">requiredQuiz</span><span class="text">
</span>                <span class="name">foundPath</span> <span class="operator">=</span> <span class="name">False</span><span class="text">
</span>                <span class="keyword">for</span> <span class="name">path</span> <span class="keyword">in</span> <span class="name">requiredQuiz</span><span class="operator">.</span><span class="name">paths</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span><span class="notcovered">                        <span class="keyword">if</span> <span class="operator">(</span><span class="name">path</span><span class="operator">.</span><span class="name">passed</span> <span class="operator">==</span> <span class="name">True</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                                <span class="name">foundPath</span> <span class="operator">=</span> <span class="name">True</span></span><span class="text">
</span>                <span class="keyword">if</span> <span class="operator">(</span><span class="name">foundPath</span> <span class="operator">==</span> <span class="name">False</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                        <span class="name">errors</span><span class="operator">.</span><span class="name">append</span><span class="operator">(</span><span class="name">requiredQuiz</span><span class="operator">.</span><span class="name">name</span> <span class="operator">+</span> <span class="string">" does not have a passing path"</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span>        <span class="keyword">for</span> <span class="name">q</span> <span class="keyword">in</span> <span class="name">questions</span><span class="operator">:</span><span class="text">
</span>                <span class="keyword">if</span> <span class="operator">(</span><span class="name">isMultipleChoiceQuestion</span><span class="operator">(</span><span class="name">q</span><span class="operator">)</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                        <span class="comment"># Multiple Choice Question - Make sure its not blank
</span>                        <span class="name">q</span> <span class="operator">=</span> <span class="name">q</span><span class="operator">.</span><span class="name">multiplechoicequestion</span><span class="text">
</span>                        <span class="keyword">if</span> <span class="operator">(</span><span class="name">len</span><span class="operator">(</span><span class="name">q</span><span class="operator">.</span><span class="name">text</span><span class="operator">)</span> <span class="operator">==</span> <span class="number">0</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                                <span class="name">errors</span><span class="operator">.</span><span class="name">append</span><span class="operator">(</span><span class="string">"Question cannot have a blank prompt"</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span>                        <span class="name">answers</span> <span class="operator">=</span> <span class="name">q</span><span class="operator">.</span><span class="name">answers</span><span class="operator">.</span><span class="name">all</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>                        <span class="text">
</span>                        <span class="comment"># Question must have at least two possible answers
</span>                        <span class="keyword">if</span> <span class="operator">(</span><span class="name">len</span><span class="operator">(</span><span class="name">answers</span><span class="operator">)</span> <span class="operator">&lt;</span> <span class="number">2</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span><span class="notcovered">                                <span class="name">errors</span><span class="operator">.</span><span class="name">append</span><span class="operator">(</span><span class="string">"Answer must have at least two possible answers"</span><span class="operator">)</span></span><span class="text">
</span><span class="text">
</span>                        <span class="name">foundCorrect</span> <span class="operator">=</span> <span class="name">False</span><span class="text">
</span>                        <span class="keyword">for</span> <span class="name">a</span> <span class="keyword">in</span> <span class="name">answers</span><span class="operator">:</span><span class="text">
</span>                                <span class="comment"># Answer must not be blank
</span>                                <span class="keyword">if</span> <span class="operator">(</span><span class="name">len</span><span class="operator">(</span><span class="name">a</span><span class="operator">.</span><span class="name">text</span><span class="operator">)</span> <span class="operator">==</span> <span class="number">0</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                                        <span class="name">errors</span><span class="operator">.</span><span class="name">append</span><span class="operator">(</span><span class="string">"Answer must not be blank"</span><span class="operator">)</span><span class="text">
</span>                                <span class="keyword">if</span> <span class="operator">(</span><span class="name">a</span><span class="operator">.</span><span class="name">correct</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                                        <span class="name">foundCorrect</span> <span class="operator">=</span> <span class="name">True</span><span class="text">
</span><span class="text">
</span>                        <span class="comment"># Question must have a correct answer
</span>                        <span class="keyword">if</span> <span class="operator">(</span><span class="keyword">not</span> <span class="name">foundCorrect</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span><span class="notcovered">                                <span class="name">errors</span><span class="operator">.</span><span class="name">append</span><span class="operator">(</span><span class="string">"Question must have a correct answer"</span><span class="operator">)</span></span><span class="text">
</span>                <span class="keyword">else</span><span class="operator">:</span><span class="text">
</span>                        <span class="name">q</span> <span class="operator">=</span> <span class="name">q</span><span class="operator">.</span><span class="name">codequestion</span><span class="text">
</span>                        <span class="text">
</span>                        <span class="comment"># Prompt must not be blank
</span>                        <span class="keyword">if</span> <span class="operator">(</span><span class="name">len</span><span class="operator">(</span><span class="name">q</span><span class="operator">.</span><span class="name">text</span><span class="operator">)</span> <span class="operator">==</span> <span class="number">0</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                                <span class="name">errors</span><span class="operator">.</span><span class="name">append</span><span class="operator">(</span><span class="string">"Code Question prompt must not be blank"</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span>                        <span class="comment"># Expected output must not be blank
</span>                        <span class="keyword">if</span> <span class="operator">(</span><span class="name">len</span><span class="operator">(</span><span class="name">q</span><span class="operator">.</span><span class="name">expectedOutput</span><span class="operator">)</span> <span class="operator">==</span> <span class="number">0</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                                <span class="name">errors</span><span class="operator">.</span><span class="name">append</span><span class="operator">(</span><span class="string">"Code Question expected output must not be blank"</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span>        <span class="comment"># Question Ordering - Must be valid
</span>        <span class="keyword">if</span> <span class="operator">(</span><span class="keyword">not</span> <span class="name">validateQuestionOrder</span><span class="operator">(</span><span class="name">self</span><span class="operator">)</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                <span class="name">errors</span><span class="operator">.</span><span class="name">append</span><span class="operator">(</span><span class="string">"Questions must have a valid ordering"</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span>        <span class="keyword">return</span> <span class="name">errors</span><span class="text"></span>
</pre></body>
</html>
