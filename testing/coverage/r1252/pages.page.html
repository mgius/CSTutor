<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
  "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>code coverage of page.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">

<style type="text/css">
pre.code {
    font-style: Lucida,"Courier New";
}
.number {
    color: #0080C0;
}
.operator {
    color: #000000;
}
.string {
    color: #008000;
}
.comment {
    color: #808080;
}
.name {
    color: #000000;
}
.error {
    color: #FF8080;
    border: solid 1.5pt #FF0000;
}
.keyword {
    color: #0000FF;
    font-weight: bold;
}
.text {
    color: #000000;
}
.notcovered {
    background-color: #FFB2B2;
}
</style>

</head>
<body>
<pre class="code">
<span class="string">'''
page.py file for page related operations.

Contains operations for all pages
The operations on page involve representing a linked structure (the page heirarchy) in a database. In order to accomplish this, we give each page a left and right integer value. These two numbers help us to create a sibling/child relationship between pages in order to construct the proper organization as seen in the navigation bar.

@author Matthew Tytel
@author Mark Gius

'''</span><span class="text">
</span><span class="notcovered"><span class="keyword">from</span> <span class="name">models</span> <span class="keyword">import</span> <span class="operator">*</span></span><span class="text">
</span><span class="notcovered"></span><span class="text">
</span><span class="notcovered"><span class="keyword">def</span> <span class="name">getNextPage</span><span class="operator">(</span><span class="name">self</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span>        <span class="string">'''
        Gets the next page in the preorder traversal of the page hierarchy

        Returns the page object that is the "next" page

        @author Mark Gius
        '''</span><span class="text">
</span>   <span class="comment"># This returns the first object whose left is greater than mine, in my course
</span>   <span class="comment"># however it does this at the database level
</span>        <span class="keyword">try</span><span class="operator">:</span><span class="text">
</span>                <span class="name">p</span> <span class="operator">=</span> <span class="name">Page</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">filter</span><span class="operator">(</span><span class="name">course__exact</span><span class="operator">=</span><span class="name">self</span><span class="operator">.</span><span class="name">course</span><span class="operator">)</span>\
                                <span class="operator">.</span><span class="name">filter</span><span class="operator">(</span><span class="name">left__gt</span><span class="operator">=</span><span class="name">self</span><span class="operator">.</span><span class="name">left</span><span class="operator">)</span><span class="operator">.</span><span class="name">order_by</span><span class="operator">(</span><span class="string">'left'</span><span class="operator">)</span><span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="text">
</span>        <span class="keyword">except</span> <span class="name">IndexError</span><span class="operator">:</span><span class="text">
</span>                <span class="name">p</span> <span class="operator">=</span> <span class="name">None</span><span class="text">
</span>        <span class="keyword">return</span> <span class="name">p</span><span class="text">
</span><span class="text">
</span><span class="notcovered"><span class="keyword">def</span> <span class="name">getPrevPage</span><span class="operator">(</span><span class="name">self</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span>        <span class="string">'''
        Gets the previous page in the preorder traversal of the page heirarchy

        Returns the page object that is the "previous" page
        
        @author Mark Gius
        '''</span><span class="text">
</span>   <span class="comment"># returns the first object whose left is less than mine
</span>        <span class="keyword">try</span><span class="operator">:</span><span class="text">
</span>                <span class="name">p</span> <span class="operator">=</span> <span class="name">Page</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">filter</span><span class="operator">(</span><span class="name">course__exact</span><span class="operator">=</span><span class="name">self</span><span class="operator">.</span><span class="name">course</span><span class="operator">)</span>\
                           <span class="operator">.</span><span class="name">filter</span><span class="operator">(</span><span class="name">left__lt</span><span class="operator">=</span><span class="name">self</span><span class="operator">.</span><span class="name">left</span><span class="operator">)</span><span class="operator">.</span><span class="name">order_by</span><span class="operator">(</span><span class="string">'-left'</span><span class="operator">)</span><span class="operator">[</span><span class="number">0</span><span class="operator">]</span><span class="text">
</span><span class="notcovered">        <span class="keyword">except</span> <span class="name">KeyError</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                <span class="name">p</span> <span class="operator">=</span> <span class="name">None</span></span><span class="text">
</span><span class="notcovered">        <span class="keyword">except</span> <span class="name">IndexError</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                <span class="comment">#happens if filter returns no objects which happens when called on the
</span>                <span class="comment">#top-most page of a course
</span>                <span class="name">p</span> <span class="operator">=</span> <span class="name">None</span></span><span class="text">
</span>        <span class="keyword">return</span> <span class="name">p</span><span class="text">
</span><span class="text">
</span><span class="notcovered"><span class="keyword">def</span> <span class="name">insertPageAfterNum</span><span class="operator">(</span><span class="name">self</span><span class="operator">,</span> <span class="name">course</span><span class="operator">,</span> <span class="name">insertAfterNum</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span>        <span class="string">''' 
        Inserts a page after "num"

        Inserting a page at "0" makes this page the "first" page

        Inserting a page after a pages "left" makes this page the first child
        of the insertAfterNum page.

        Inserting a page after a pages "right" makes this page the next sibling
        of the insertAfterNum page.

        Those who don't want to deal with the structure of the pages should use
        insertPage instead of this

        @post: ValidateTree(self.course) == True
        @author Mark Gius
   '''</span><span class="text">
</span>        <span class="name">self</span><span class="operator">.</span><span class="name">left</span> <span class="operator">=</span> <span class="name">insertAfterNum</span> <span class="operator">+</span> <span class="number">1</span><span class="text">
</span>        <span class="name">self</span><span class="operator">.</span><span class="name">right</span> <span class="operator">=</span> <span class="name">insertAfterNum</span> <span class="operator">+</span> <span class="number">2</span><span class="text">
</span>        <span class="name">self</span><span class="operator">.</span><span class="name">course</span> <span class="operator">=</span> <span class="name">course</span><span class="text">
</span>        <span class="name">coursePages</span> <span class="operator">=</span> <span class="name">Page</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">filter</span><span class="operator">(</span><span class="name">course__exact</span><span class="operator">=</span><span class="name">self</span><span class="operator">.</span><span class="name">course</span><span class="operator">)</span><span class="text">
</span>        <span class="comment">#by our new convention pages with left &lt;= 0 will be ignored
</span>        <span class="name">coursePages</span> <span class="operator">=</span> <span class="name">coursePages</span><span class="operator">.</span><span class="name">exclude</span><span class="operator">(</span><span class="name">left__lte</span><span class="operator">=</span><span class="number">0</span><span class="operator">)</span><span class="text">
</span>        <span class="comment"># These pages are later in the tree, both left and right need to be inc by 2
</span>        <span class="name">updateLeft</span> <span class="operator">=</span> <span class="name">coursePages</span><span class="operator">.</span><span class="name">filter</span><span class="operator">(</span><span class="name">left__gt</span><span class="operator">=</span><span class="name">insertAfterNum</span><span class="operator">)</span><span class="text">
</span>        <span class="keyword">for</span> <span class="name">page</span> <span class="keyword">in</span> <span class="name">updateLeft</span><span class="operator">:</span><span class="text">
</span>                <span class="name">page</span><span class="operator">.</span><span class="name">left</span> <span class="operator">+=</span> <span class="number">2</span><span class="text">
</span>                <span class="name">page</span><span class="operator">.</span><span class="name">right</span> <span class="operator">+=</span> <span class="number">2</span><span class="text">
</span>                <span class="name">page</span><span class="operator">.</span><span class="name">save</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>        <span class="text">
</span>        <span class="comment"># these pages are previous in the tree, but need their "right" updated
</span>        <span class="name">updateRight</span> <span class="operator">=</span> <span class="name">coursePages</span><span class="operator">.</span><span class="name">filter</span><span class="operator">(</span><span class="name">right__gt</span><span class="operator">=</span><span class="name">insertAfterNum</span><span class="operator">)</span>\
                                 <span class="operator">.</span><span class="name">exclude</span><span class="operator">(</span><span class="name">left__gt</span><span class="operator">=</span><span class="name">insertAfterNum</span><span class="operator">)</span><span class="text">
</span>        <span class="keyword">for</span> <span class="name">page</span> <span class="keyword">in</span> <span class="name">updateRight</span><span class="operator">:</span><span class="text">
</span>                <span class="name">page</span><span class="operator">.</span><span class="name">right</span> <span class="operator">+=</span> <span class="number">2</span><span class="text">
</span>                <span class="name">page</span><span class="operator">.</span><span class="name">save</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span>        <span class="name">self</span><span class="operator">.</span><span class="name">save</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span>        <span class="keyword">return</span> <span class="name">self</span><span class="text">
</span><span class="text">
</span><span class="notcovered"><span class="keyword">def</span> <span class="name">insertPage</span><span class="operator">(</span><span class="name">self</span><span class="operator">,</span> <span class="name">insertAfter</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span>        <span class="string">''' Inserts the page self after the page insertAfter in the course course

                 This creates the page as the next sibling of the insertAfter page

                 Returns the inserted page after committing it
                 @author Mark Gius

                 @post: ValidateTree(self.course) == True

        '''</span><span class="text">
</span>        <span class="keyword">return</span> <span class="name">insertPageAfterNum</span><span class="operator">(</span><span class="name">self</span><span class="operator">,</span> <span class="name">insertAfter</span><span class="operator">.</span><span class="name">course</span><span class="operator">,</span> <span class="name">insertAfter</span><span class="operator">.</span><span class="name">right</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span><span class="notcovered"><span class="keyword">def</span> <span class="name">insertChildPage</span><span class="operator">(</span><span class="name">self</span><span class="operator">,</span> <span class="name">parentPage</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span>        <span class="string">''' Inserts the page self as the first child of the parentPage

                 Returns the inserted page after committing it
                 @post: ValidateTree(self.course) == True
                 @author Mark Gius

        '''</span><span class="text">
</span>        <span class="keyword">return</span> <span class="name">insertPageAfterNum</span><span class="operator">(</span><span class="name">self</span><span class="operator">,</span> <span class="name">parentPage</span><span class="operator">.</span><span class="name">course</span><span class="operator">,</span> <span class="name">parentPage</span><span class="operator">.</span><span class="name">left</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span><span class="notcovered"><span class="keyword">def</span> <span class="name">removePage</span><span class="operator">(</span><span class="name">self</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span>        <span class="string">''' Removes the given page from its course

                 Returns the page deleted

                 @post: ValidateTree(self.course) == True
                 @author Mark Gius

        '''</span><span class="text">
</span>        <span class="name">coursePages</span> <span class="operator">=</span> <span class="name">Page</span><span class="operator">.</span><span class="name">objects</span><span class="operator">.</span><span class="name">filter</span><span class="operator">(</span><span class="name">course__exact</span><span class="operator">=</span><span class="name">self</span><span class="operator">.</span><span class="name">course</span><span class="operator">)</span><span class="text">
</span>        <span class="comment">#by our new convention pages with left &lt;= 0 will be ignored
</span>        <span class="name">coursePages</span> <span class="operator">=</span> <span class="name">coursePages</span><span class="operator">.</span><span class="name">exclude</span><span class="operator">(</span><span class="name">left__lte</span><span class="operator">=</span><span class="number">0</span><span class="operator">)</span><span class="text">
</span>        <span class="name">removeNumber</span> <span class="operator">=</span> <span class="name">self</span><span class="operator">.</span><span class="name">left</span><span class="text">
</span><span class="text">
</span>   <span class="comment"># have to use list to force evaluation, otherwise the numbers won't work out
</span>        <span class="name">updateLeft</span> <span class="operator">=</span> <span class="name">list</span><span class="operator">(</span><span class="name">coursePages</span><span class="operator">.</span><span class="name">filter</span><span class="operator">(</span><span class="name">left__gt</span><span class="operator">=</span><span class="name">removeNumber</span><span class="operator">)</span><span class="operator">)</span><span class="text">
</span>        <span class="name">updateRight</span> <span class="operator">=</span> <span class="name">list</span><span class="operator">(</span><span class="name">coursePages</span><span class="operator">.</span><span class="name">filter</span><span class="operator">(</span><span class="name">right__gt</span><span class="operator">=</span><span class="name">removeNumber</span><span class="operator">)</span>\
                                 <span class="operator">.</span><span class="name">exclude</span><span class="operator">(</span><span class="name">left__gt</span><span class="operator">=</span><span class="name">removeNumber</span><span class="operator">)</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span>        <span class="comment"># These pages are later in the tree, both left and right need to be dec by 2
</span>        <span class="keyword">for</span> <span class="name">page</span> <span class="keyword">in</span> <span class="name">updateLeft</span><span class="operator">:</span><span class="text">
</span>                <span class="name">page</span><span class="operator">.</span><span class="name">left</span> <span class="operator">-=</span> <span class="number">2</span><span class="text">
</span>                <span class="name">page</span><span class="operator">.</span><span class="name">right</span> <span class="operator">-=</span> <span class="number">2</span><span class="text">
</span>                <span class="name">page</span><span class="operator">.</span><span class="name">save</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>        <span class="text">
</span>        <span class="comment"># these pages are previous in the tree, but need their "right" updated
</span>        <span class="keyword">for</span> <span class="name">page</span> <span class="keyword">in</span> <span class="name">updateRight</span><span class="operator">:</span><span class="text">
</span>                <span class="name">page</span><span class="operator">.</span><span class="name">right</span> <span class="operator">-=</span> <span class="number">2</span><span class="text">
</span>                <span class="name">page</span><span class="operator">.</span><span class="name">save</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>        <span class="text">
</span>        <span class="name">self</span><span class="operator">.</span><span class="name">delete</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>        <span class="keyword">return</span> <span class="name">self</span><span class="text">
</span><span class="text">
</span><span class="notcovered"><span class="keyword">def</span> <span class="name">movePage</span><span class="operator">(</span><span class="name">self</span><span class="operator">,</span> <span class="name">insertAfter</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span>        <span class="string">'''
        Moves the page to a new location. 

        Moves the page from its current location to be the next sibling of the
        supplied page

        returns the page moved
        @post: ValidateTree(self.course) == True
        @author Mark Gius

        '''</span><span class="text">
</span><span class="text">
</span>        <span class="comment">#set left to 0 makes this page be ignored by the insert function
</span>        <span class="name">self</span><span class="operator">.</span><span class="name">left</span> <span class="operator">=</span> <span class="number">0</span><span class="text">
</span>        <span class="name">self</span><span class="operator">.</span><span class="name">save</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>        <span class="name">insertPage</span><span class="operator">(</span><span class="name">self</span><span class="operator">,</span> <span class="name">insertAfter</span><span class="operator">)</span><span class="text">
</span>        <span class="keyword">return</span> <span class="name">self</span><span class="text">
</span><span class="text">
</span><span class="notcovered"><span class="keyword">def</span> <span class="name">movePageToParent</span><span class="operator">(</span><span class="name">self</span><span class="operator">,</span> <span class="name">newParent</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span>        <span class="string">'''
        Moves the page to a new location.

        Moves the page from its current location to be the first child of the 
        supplied page

        returns the page moved
        @post: ValidateTree(self.course) == True
        @author Mark Gius

        '''</span><span class="text">
</span><span class="text">
</span>        <span class="comment">#set left to 0 makes this page be ignored by the insert function
</span>        <span class="name">self</span><span class="operator">.</span><span class="name">left</span> <span class="operator">=</span> <span class="number">0</span><span class="text">
</span>        <span class="name">self</span><span class="operator">.</span><span class="name">save</span><span class="operator">(</span><span class="operator">)</span><span class="text">
</span>        <span class="name">insertChildPage</span><span class="operator">(</span><span class="name">self</span><span class="operator">,</span> <span class="name">newParent</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span>        <span class="keyword">return</span> <span class="name">self</span><span class="text"></span>
</pre></body>
</html>
