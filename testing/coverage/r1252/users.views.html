<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
  "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<title>code coverage of views.py</title>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1">

<style type="text/css">
pre.code {
    font-style: Lucida,"Courier New";
}
.number {
    color: #0080C0;
}
.operator {
    color: #000000;
}
.string {
    color: #008000;
}
.comment {
    color: #808080;
}
.name {
    color: #000000;
}
.error {
    color: #FF8080;
    border: solid 1.5pt #FF0000;
}
.keyword {
    color: #0000FF;
    font-weight: bold;
}
.text {
    color: #000000;
}
.notcovered {
    background-color: #FFB2B2;
}
</style>

</head>
<body>
<pre class="code">
<span class="string">'''
users/views.py - This is where all user-related pages are rendered, such as profile, login, logout, registerNewUser...
@author John Hartquist
@author Russell Mezzetta
'''</span><span class="text">
</span><span class="keyword">from</span> <span class="name">django</span><span class="operator">.</span><span class="name">core</span><span class="operator">.</span><span class="name">urlresolvers</span> <span class="keyword">import</span> <span class="name">reverse</span><span class="text">
</span><span class="keyword">from</span> <span class="name">django</span><span class="operator">.</span><span class="name">http</span> <span class="keyword">import</span> <span class="name">HttpResponse</span><span class="operator">,</span> <span class="name">HttpResponseRedirect</span><span class="text">
</span><span class="keyword">from</span> <span class="name">django</span><span class="operator">.</span><span class="name">shortcuts</span> <span class="keyword">import</span> <span class="name">render_to_response</span><span class="text">
</span><span class="keyword">from</span> <span class="name">django</span><span class="operator">.</span><span class="name">contrib</span><span class="operator">.</span><span class="name">auth</span><span class="operator">.</span><span class="name">models</span> <span class="keyword">import</span> <span class="name">User</span><span class="text">
</span><span class="keyword">from</span> <span class="name">django</span><span class="operator">.</span><span class="name">contrib</span><span class="operator">.</span><span class="name">auth</span> <span class="keyword">import</span> <span class="name">authenticate</span><span class="operator">,</span> <span class="name">login</span><span class="operator">,</span> <span class="name">logout</span><span class="text">
</span><span class="keyword">from</span> <span class="name">home</span><span class="operator">.</span><span class="name">views</span> <span class="keyword">import</span> <span class="name">index</span><span class="operator">,</span> <span class="name">master_rtr</span><span class="text">
</span><span class="keyword">from</span> <span class="name">user</span> <span class="keyword">import</span> <span class="name">registerNewUser</span><span class="operator">,</span> <span class="name">loginWrapper</span><span class="operator">,</span> <span class="name">updateEmail</span><span class="operator">,</span> <span class="name">changePassword</span><span class="operator">,</span> <span class="name">updateName</span><span class="operator">,</span> <span class="name">deleteUser</span><span class="text">
</span><span class="text">
</span><span class="keyword">def</span> <span class="name">show_profile</span><span class="operator">(</span><span class="name">request</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>        <span class="string">'''
        Displays the profile of the user that is currently logged in
        @author John Hartquist
        @pre user.is_authenticated() == True
        @post 
        '''</span><span class="text">
</span>        <span class="comment">#print 'in show_profile'
</span><span class="text">
</span>        <span class="comment">#make sure user is logged in
</span>        <span class="keyword">if</span> <span class="name">request</span><span class="operator">.</span><span class="name">user</span><span class="operator">.</span><span class="name">is_authenticated</span><span class="operator">(</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                <span class="comment">#check if method was post
</span>                <span class="keyword">if</span> <span class="operator">(</span><span class="name">request</span><span class="operator">.</span><span class="name">method</span><span class="operator">==</span><span class="string">"POST"</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                        <span class="keyword">if</span> <span class="operator">(</span><span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">[</span><span class="string">"form"</span><span class="operator">]</span> <span class="operator">==</span> <span class="string">"Change E-mail"</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                                <span class="name">status</span> <span class="operator">=</span> <span class="name">updateEmail</span><span class="operator">(</span><span class="name">request</span><span class="operator">)</span><span class="text">
</span>                                <span class="keyword">if</span> <span class="name">status</span> <span class="operator">==</span> <span class="number">0</span><span class="operator">:</span><span class="text">
</span><span class="notcovered">                                        <span class="keyword">return</span> <span class="name">master_rtr</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="string">'user/profile.html'</span><span class="operator">,</span> <span class="operator">{</span><span class="string">'user'</span><span class="operator">:</span> <span class="name">request</span><span class="operator">.</span><span class="name">user</span><span class="operator">}</span><span class="operator">)</span></span><span class="text">
</span>                                <span class="keyword">else</span><span class="operator">:</span><span class="text">
</span>                                        <span class="keyword">return</span> <span class="name">master_rtr</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="string">'user/profile.html'</span><span class="operator">,</span> <span class="text">
</span>                                                       <span class="operator">{</span><span class="string">'user'</span><span class="operator">:</span> <span class="name">request</span><span class="operator">.</span><span class="name">user</span><span class="operator">,</span><span class="text">
</span>                                                        <span class="string">'emailError'</span><span class="operator">:</span> <span class="string">"Invalid E-mail Address"</span><span class="operator">}</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span><span class="notcovered">                        <span class="keyword">if</span> <span class="operator">(</span><span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">[</span><span class="string">"form"</span><span class="operator">]</span> <span class="operator">==</span> <span class="string">"Change Password"</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                                <span class="name">status</span> <span class="operator">=</span> <span class="name">changePassword</span><span class="operator">(</span><span class="name">request</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                                <span class="keyword">if</span> <span class="name">status</span> <span class="operator">==</span> <span class="number">1</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                                        <span class="keyword">return</span> <span class="name">master_rtr</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="string">'user/profile.html'</span><span class="operator">,</span></span> <span class="text">
</span><span class="notcovered">                                                       <span class="operator">{</span><span class="string">'user'</span><span class="operator">:</span> <span class="name">request</span><span class="operator">.</span><span class="name">user</span><span class="operator">,</span></span><span class="text">
</span><span class="notcovered">                                                                                            <span class="string">'passError'</span><span class="operator">:</span> <span class="string">"Incorrect current password"</span><span class="operator">}</span><span class="operator">)</span></span>                                    <span class="text">
</span><span class="notcovered">                                <span class="keyword">elif</span> <span class="name">status</span> <span class="operator">==</span> <span class="number">2</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                                        <span class="keyword">return</span> <span class="name">master_rtr</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="string">'user/profile.html'</span><span class="operator">,</span></span> <span class="text">
</span><span class="notcovered">                                                       <span class="operator">{</span><span class="string">'user'</span><span class="operator">:</span> <span class="name">request</span><span class="operator">.</span><span class="name">user</span><span class="operator">,</span></span><span class="text">
</span><span class="notcovered">                                                                                            <span class="string">'passError'</span><span class="operator">:</span> <span class="string">"Password do not match"</span><span class="operator">}</span><span class="operator">)</span></span>      <span class="text">
</span><span class="notcovered">                        <span class="keyword">if</span> <span class="operator">(</span><span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">[</span><span class="string">"form"</span><span class="operator">]</span> <span class="operator">==</span> <span class="string">"Delete Account"</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                                <span class="keyword">return</span> <span class="name">master_rtr</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="string">'user/confirmDelete.html'</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered"></span>                        <span class="text">
</span><span class="notcovered">                        <span class="keyword">if</span> <span class="operator">(</span><span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">[</span><span class="string">"form"</span><span class="operator">]</span> <span class="operator">==</span> <span class="string">"Update Name"</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                                <span class="name">status</span> <span class="operator">=</span> <span class="name">updateName</span><span class="operator">(</span><span class="name">request</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                                <span class="keyword">if</span> <span class="name">status</span> <span class="operator">==</span> <span class="number">0</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                                        <span class="keyword">return</span> <span class="name">master_rtr</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="string">'user/profile.html'</span><span class="operator">,</span> <span class="operator">{</span><span class="string">'user'</span><span class="operator">:</span> <span class="name">request</span><span class="operator">.</span><span class="name">user</span><span class="operator">,</span> <span class="string">'nameMessage'</span><span class="operator">:</span><span class="string">"Update Successful"</span> <span class="operator">}</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                        <span class="keyword">if</span> <span class="operator">(</span><span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">[</span><span class="string">"form"</span><span class="operator">]</span> <span class="operator">==</span> <span class="string">"Yes"</span><span class="operator">)</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                                <span class="name">status</span> <span class="operator">=</span> <span class="name">deleteUser</span><span class="operator">(</span><span class="name">request</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                                <span class="keyword">if</span> <span class="name">status</span> <span class="operator">==</span> <span class="number">0</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                                        <span class="keyword">return</span> <span class="name">HttpResponseRedirect</span><span class="operator">(</span><span class="name">reverse</span><span class="operator">(</span><span class="string">'home.views.show_homepage'</span><span class="operator">)</span><span class="operator">)</span></span>                <span class="text">
</span>                        <span class="text">
</span>                        <span class="text">
</span>                <span class="keyword">return</span> <span class="name">master_rtr</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="string">'user/profile.html'</span><span class="operator">,</span> <span class="operator">{</span><span class="string">'user'</span><span class="operator">:</span><span class="name">request</span><span class="operator">.</span><span class="name">user</span><span class="operator">}</span><span class="operator">)</span><span class="text">
</span>        <span class="keyword">else</span><span class="operator">:</span><span class="text">
</span><span class="notcovered">                <span class="keyword">return</span> <span class="name">master_rtr</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="string">'user/notloggedin.html'</span><span class="operator">)</span></span><span class="text">
</span>        <span class="text">
</span><span class="keyword">def</span> <span class="name">show_logout</span><span class="operator">(</span><span class="name">request</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>        <span class="string">'''
        Logs out the current user
        @author John Hartquist
        @author Russell Mezzetta
        @pre
        @post request.user.is_authenticated() == false
        '''</span><span class="text">
</span>        <span class="comment">#russ--making logout not really log people out in certain cases
</span>        <span class="name">username</span> <span class="operator">=</span> <span class="name">None</span><span class="text">
</span>        <span class="name">lastCourseSlug</span> <span class="operator">=</span> <span class="name">None</span><span class="text">
</span>        <span class="keyword">if</span> <span class="name">request</span><span class="operator">.</span><span class="name">user</span><span class="operator">.</span><span class="name">is_authenticated</span><span class="operator">(</span><span class="operator">)</span> <span class="operator">==</span> <span class="name">True</span><span class="operator">:</span><span class="text">
</span>                <span class="keyword">if</span> <span class="string">'rememberme'</span> <span class="keyword">in</span> <span class="name">request</span><span class="operator">.</span><span class="name">session</span><span class="operator">:</span><span class="text">
</span>                   <span class="name">username</span> <span class="operator">=</span> <span class="name">request</span><span class="operator">.</span><span class="name">user</span><span class="operator">.</span><span class="name">username</span><span class="text">
</span>                <span class="keyword">if</span> <span class="string">'lastCourseSlug'</span> <span class="keyword">in</span> <span class="name">request</span><span class="operator">.</span><span class="name">session</span> <span class="keyword">and</span> <span class="string">'lastPageSlug'</span> <span class="keyword">in</span> <span class="name">request</span><span class="operator">.</span><span class="name">session</span> <span class="keyword">and</span> <span class="string">'lastPageEdit'</span> <span class="keyword">in</span> <span class="name">request</span><span class="operator">.</span><span class="name">session</span><span class="operator">:</span><span class="text">
</span><span class="notcovered">                        <span class="name">lastCourseSlug</span> <span class="operator">=</span> <span class="name">request</span><span class="operator">.</span><span class="name">session</span><span class="operator">[</span><span class="string">'lastCourseSlug'</span><span class="operator">]</span></span><span class="text">
</span><span class="notcovered">                        <span class="name">lastPageSlug</span> <span class="operator">=</span> <span class="name">request</span><span class="operator">.</span><span class="name">session</span><span class="operator">[</span><span class="string">'lastPageSlug'</span><span class="operator">]</span></span><span class="text">
</span><span class="notcovered">                        <span class="name">lastPageEdit</span> <span class="operator">=</span> <span class="name">request</span><span class="operator">.</span><span class="name">session</span><span class="operator">[</span><span class="string">'lastPageEdit'</span><span class="operator">]</span></span><span class="text">
</span><span class="text">
</span>        <span class="comment">#logout flushes the contents of the session/cookie
</span>        <span class="name">logout</span><span class="operator">(</span><span class="name">request</span><span class="operator">)</span><span class="text">
</span>        <span class="keyword">if</span> <span class="name">username</span> <span class="operator">!=</span> <span class="name">None</span><span class="operator">:</span><span class="text">
</span>                <span class="name">request</span><span class="operator">.</span><span class="name">session</span><span class="operator">[</span><span class="string">'username'</span><span class="operator">]</span> <span class="operator">=</span> <span class="name">username</span><span class="text">
</span>                <span class="name">request</span><span class="operator">.</span><span class="name">session</span><span class="operator">[</span><span class="string">'rememberme'</span><span class="operator">]</span> <span class="operator">=</span> <span class="name">True</span><span class="text">
</span>        <span class="keyword">if</span> <span class="name">lastCourseSlug</span> <span class="operator">!=</span> <span class="name">None</span><span class="operator">:</span><span class="text">
</span><span class="notcovered">                <span class="name">request</span><span class="operator">.</span><span class="name">session</span><span class="operator">[</span><span class="string">'lastCourseSlug'</span><span class="operator">]</span> <span class="operator">=</span> <span class="name">lastCourseSlug</span></span><span class="text">
</span><span class="notcovered">                <span class="name">request</span><span class="operator">.</span><span class="name">session</span><span class="operator">[</span><span class="string">'lastPageSlug'</span><span class="operator">]</span> <span class="operator">=</span> <span class="name">lastPageSlug</span></span><span class="text">
</span><span class="notcovered">                <span class="name">request</span><span class="operator">.</span><span class="name">session</span><span class="operator">[</span><span class="string">'lastPageEdit'</span><span class="operator">]</span> <span class="operator">=</span> <span class="name">lastPageEdit</span></span><span class="text">
</span><span class="text">
</span>        <span class="keyword">return</span> <span class="name">render_to_response</span><span class="operator">(</span><span class="string">'user/logout.html'</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span><span class="keyword">def</span> <span class="name">show_login</span><span class="operator">(</span><span class="name">request</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>        <span class="string">'''
        @author Russell Mezzetta
        This shows the login page and displays any errors.
        @pre request is a requestobject
        @post
        '''</span><span class="text">
</span>        <span class="comment">#print 'in show_login'
</span>        <span class="text">
</span>        <span class="comment">#before processing check if user's session has autologin/rememberme set
</span>        <span class="comment">#based on assumption that if we don't log the user out then they will stay authenticated
</span>        <span class="keyword">if</span> <span class="name">request</span><span class="operator">.</span><span class="name">user</span><span class="operator">.</span><span class="name">is_authenticated</span><span class="operator">(</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>                <span class="comment">#print "user authenticated"
</span>                <span class="keyword">if</span> <span class="string">'autologin'</span> <span class="keyword">in</span> <span class="name">request</span><span class="operator">.</span><span class="name">session</span><span class="operator">:</span><span class="text">
</span><span class="notcovered">                        <span class="keyword">if</span> <span class="name">request</span><span class="operator">.</span><span class="name">session</span><span class="operator">[</span><span class="string">'autologin'</span><span class="operator">]</span> <span class="operator">==</span> <span class="name">True</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                                <span class="keyword">return</span> <span class="name">HttpResponseRedirect</span><span class="operator">(</span><span class="name">reverse</span><span class="operator">(</span><span class="string">'home.views.show_homepage'</span><span class="operator">)</span><span class="operator">)</span></span><span class="text">
</span><span class="text">
</span>        <span class="keyword">if</span> <span class="name">request</span><span class="operator">.</span><span class="name">method</span> <span class="operator">==</span> <span class="string">'POST'</span><span class="operator">:</span><span class="text">
</span>                <span class="comment">#form was submitted
</span>                <span class="name">username</span> <span class="operator">=</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">[</span><span class="string">'username'</span><span class="operator">]</span><span class="text">
</span>                <span class="name">password</span> <span class="operator">=</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">[</span><span class="string">'password'</span><span class="operator">]</span><span class="text">
</span>                <span class="comment">#checkboxes don't put anything in post if they are unchecked so we have to do a little
</span>                <span class="comment">#extra work. This involves making a list of the possible checkboxes.
</span>                <span class="name">checkboxList</span> <span class="operator">=</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">.</span><span class="name">getlist</span><span class="operator">(</span><span class="string">'anonymous'</span><span class="operator">)</span><span class="text">
</span>                <span class="name">checkboxList</span> <span class="operator">+=</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">.</span><span class="name">getlist</span><span class="operator">(</span><span class="string">'autologin'</span><span class="operator">)</span><span class="text">
</span>                <span class="name">checkboxList</span> <span class="operator">+=</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">.</span><span class="name">getlist</span><span class="operator">(</span><span class="string">'rememberme'</span><span class="operator">)</span><span class="text">
</span>                <span class="comment">#set the cookie to expire when browser closes(may be changed below)
</span>                <span class="name">request</span><span class="operator">.</span><span class="name">session</span><span class="operator">.</span><span class="name">set_expiry</span><span class="operator">(</span><span class="number">0</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span>                <span class="keyword">if</span> <span class="string">"anonymous"</span> <span class="keyword">in</span> <span class="name">checkboxList</span><span class="operator">:</span><span class="text">
</span>                        <span class="comment">#bypass login
</span>                        <span class="comment">#if the session has data in it, set it to false, set cookie to expire when browser closes
</span><span class="notcovered">                        <span class="keyword">if</span> <span class="string">'autologin'</span> <span class="keyword">in</span> <span class="name">request</span><span class="operator">.</span><span class="name">session</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                                <span class="name">request</span><span class="operator">.</span><span class="name">session</span><span class="operator">[</span><span class="string">'autologin'</span><span class="operator">]</span> <span class="operator">=</span> <span class="name">False</span></span><span class="text">
</span><span class="notcovered">                        <span class="keyword">if</span> <span class="string">'rememberme'</span> <span class="keyword">in</span> <span class="name">request</span><span class="operator">.</span><span class="name">session</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                                <span class="name">request</span><span class="operator">.</span><span class="name">session</span><span class="operator">[</span><span class="string">'rememberme'</span><span class="operator">]</span> <span class="operator">=</span> <span class="name">False</span></span><span class="text">
</span><span class="notcovered">                        <span class="keyword">return</span> <span class="name">HttpResponseRedirect</span><span class="operator">(</span><span class="name">reverse</span><span class="operator">(</span><span class="string">'home.views.show_homepage'</span><span class="operator">)</span><span class="operator">)</span></span><span class="text">
</span><span class="text">
</span>                <span class="comment">#all autologin will do is make sure the cookie doesn't expire on browser close
</span>                <span class="keyword">if</span> <span class="string">"autologin"</span> <span class="keyword">in</span> <span class="name">checkboxList</span><span class="operator">:</span><span class="text">
</span>                        <span class="comment">#set cookie/session to expire in 2 weeks (1209600 is # of seconds in 2 weeks)
</span><span class="notcovered">                        <span class="name">request</span><span class="operator">.</span><span class="name">session</span><span class="operator">.</span><span class="name">set_expiry</span><span class="operator">(</span><span class="number">1209600</span><span class="operator">)</span></span><span class="text">
</span>                        <span class="comment">#request.session['autologin'] = True
</span>                        <span class="comment">#request.session['password'] = password
</span>                <span class="comment">#else:
</span>                <span class="comment">#       request.session['autologin'] = False
</span><span class="text">
</span>                <span class="keyword">if</span> <span class="string">"rememberme"</span> <span class="keyword">in</span> <span class="name">checkboxList</span><span class="operator">:</span><span class="text">
</span>                        <span class="comment">#save this in their session(auto fill username)
</span><span class="notcovered">                        <span class="name">request</span><span class="operator">.</span><span class="name">session</span><span class="operator">.</span><span class="name">set_expiry</span><span class="operator">(</span><span class="number">1209600</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                        <span class="name">request</span><span class="operator">.</span><span class="name">session</span><span class="operator">[</span><span class="string">'rememberme'</span><span class="operator">]</span> <span class="operator">=</span> <span class="name">True</span></span><span class="text">
</span><span class="notcovered">                        <span class="name">request</span><span class="operator">.</span><span class="name">session</span><span class="operator">[</span><span class="string">'username'</span><span class="operator">]</span> <span class="operator">=</span> <span class="name">username</span></span><span class="text">
</span>                <span class="keyword">else</span><span class="operator">:</span><span class="text">
</span>                        <span class="name">request</span><span class="operator">.</span><span class="name">session</span><span class="operator">[</span><span class="string">'rememberme'</span><span class="operator">]</span> <span class="operator">=</span> <span class="name">False</span><span class="text">
</span>                        <span class="name">request</span><span class="operator">.</span><span class="name">session</span><span class="operator">[</span><span class="string">'username'</span><span class="operator">]</span> <span class="operator">=</span> <span class="string">""</span><span class="text">
</span>                <span class="text">
</span>                <span class="name">ret</span> <span class="operator">=</span> <span class="name">loginWrapper</span><span class="operator">(</span><span class="name">request</span><span class="operator">,</span> <span class="name">username</span><span class="operator">,</span> <span class="name">password</span><span class="operator">)</span><span class="text">
</span>                <span class="keyword">if</span> <span class="name">ret</span> <span class="operator">==</span> <span class="number">0</span><span class="operator">:</span><span class="text">
</span>                        <span class="comment">#print "successful login"
</span>                        <span class="comment"># grab the "next" var from the GET dict, and redirect there
</span>                        <span class="keyword">if</span> <span class="string">'next'</span> <span class="keyword">in</span> <span class="name">request</span><span class="operator">.</span><span class="name">GET</span><span class="operator">:</span><span class="text">
</span><span class="notcovered">                                <span class="keyword">return</span> <span class="name">HttpResponseRedirect</span><span class="operator">(</span><span class="name">request</span><span class="operator">.</span><span class="name">GET</span><span class="operator">[</span><span class="string">'next'</span><span class="operator">]</span><span class="operator">)</span></span><span class="text">
</span>                        <span class="keyword">else</span><span class="operator">:</span><span class="text">
</span>                           <span class="comment"># send em to the index
</span>                                <span class="keyword">return</span> <span class="name">HttpResponseRedirect</span><span class="operator">(</span><span class="name">reverse</span><span class="operator">(</span><span class="string">'home.views.show_homepage'</span><span class="operator">)</span><span class="operator">)</span><span class="text">
</span>                <span class="keyword">elif</span> <span class="name">ret</span> <span class="operator">==</span> <span class="number">1</span><span class="operator">:</span><span class="text">
</span>                        <span class="comment"># Return an 'invalid login' error message.
</span>                        <span class="comment">#print "invalid login"
</span>                        <span class="keyword">return</span> <span class="name">render_to_response</span><span class="operator">(</span><span class="string">'user/login.html'</span><span class="operator">,</span> <span class="operator">{</span><span class="string">'message'</span><span class="operator">:</span> <span class="string">"Please try again, Invalid Username/Password"</span><span class="operator">}</span><span class="operator">)</span><span class="text">
</span>                <span class="keyword">else</span><span class="operator">:</span><span class="comment">#ret == 2:</span><span class="text">
</span>                        <span class="comment"># Return a 'disabled account' error message
</span>                        <span class="comment">#print "account marked as inactive"
</span><span class="notcovered">                        <span class="keyword">return</span> <span class="name">render_to_response</span><span class="operator">(</span><span class="string">'user/login.html'</span><span class="operator">,</span> <span class="operator">{</span><span class="string">'message'</span><span class="operator">:</span> <span class="string">"Account marked as inactive, contact System Admins"</span><span class="operator">}</span><span class="operator">)</span></span><span class="text">
</span>        <span class="keyword">else</span><span class="operator">:</span><span class="text">
</span>                <span class="comment">#form has not yet been submitted (first time visiting login page)
</span>                <span class="comment">#check if username is in the session so we can prefill the username field
</span>                <span class="keyword">if</span> <span class="string">'username'</span> <span class="keyword">in</span> <span class="name">request</span><span class="operator">.</span><span class="name">session</span><span class="operator">:</span><span class="text">
</span><span class="notcovered">                        <span class="keyword">return</span> <span class="name">render_to_response</span><span class="operator">(</span><span class="string">'user/login.html'</span><span class="operator">,</span> <span class="operator">{</span><span class="string">'loginusername'</span><span class="operator">:</span><span class="name">request</span><span class="operator">.</span><span class="name">session</span><span class="operator">[</span><span class="string">'username'</span><span class="operator">]</span><span class="operator">}</span><span class="operator">)</span></span><span class="text">
</span>                <span class="keyword">else</span><span class="operator">:</span><span class="text">
</span>                        <span class="keyword">return</span> <span class="name">render_to_response</span><span class="operator">(</span><span class="string">'user/login.html'</span><span class="operator">)</span><span class="text">
</span><span class="text">
</span><span class="keyword">def</span> <span class="name">show_register_new_user</span><span class="operator">(</span><span class="name">request</span><span class="operator">)</span><span class="operator">:</span><span class="text">
</span>        <span class="string">'''
        @author Russell Mezzetta
        This def shows the register new user page
        @pre request is a requestobject
        '''</span><span class="text">
</span><span class="notcovered">        <span class="keyword">print</span> <span class="string">"in show_register_new_user"</span></span><span class="text">
</span><span class="notcovered">        <span class="keyword">if</span> <span class="name">request</span><span class="operator">.</span><span class="name">method</span> <span class="operator">==</span> <span class="string">'POST'</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                <span class="comment">#form was submitted
</span>                <span class="name">username</span> <span class="operator">=</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">[</span><span class="string">'username'</span><span class="operator">]</span></span><span class="text">
</span><span class="notcovered">                <span class="name">password</span> <span class="operator">=</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">[</span><span class="string">'password'</span><span class="operator">]</span></span><span class="text">
</span><span class="notcovered">                <span class="name">vpassword</span> <span class="operator">=</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">[</span><span class="string">'verifypassword'</span><span class="operator">]</span></span><span class="text">
</span><span class="notcovered">                <span class="name">email</span> <span class="operator">=</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">[</span><span class="string">'email'</span><span class="operator">]</span></span><span class="text">
</span><span class="notcovered">                <span class="name">firstN</span> <span class="operator">=</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">[</span><span class="string">'firstname'</span><span class="operator">]</span></span><span class="text">
</span><span class="notcovered">                <span class="name">lastN</span> <span class="operator">=</span> <span class="name">request</span><span class="operator">.</span><span class="name">POST</span><span class="operator">[</span><span class="string">'lastname'</span><span class="operator">]</span></span><span class="text">
</span><span class="notcovered">                <span class="comment">#send form data to registerNewUser function
</span>                <span class="name">ret</span> <span class="operator">=</span> <span class="name">registerNewUser</span><span class="operator">(</span><span class="name">username</span><span class="operator">,</span> <span class="name">password</span><span class="operator">,</span> <span class="name">vpassword</span><span class="operator">,</span> <span class="name">firstN</span><span class="operator">,</span> <span class="name">lastN</span><span class="operator">,</span> <span class="name">email</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                <span class="keyword">if</span> <span class="name">ret</span> <span class="operator">==</span> <span class="number">0</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                        <span class="comment">#successful registration
</span>                        <span class="comment">#return render_to_response('user/login.html', {'message': "User Registration Successful"})
</span>                        <span class="comment">#TODO create a response like "success!"
</span>                        <span class="keyword">return</span> <span class="name">HttpResponseRedirect</span><span class="operator">(</span><span class="name">reverse</span><span class="operator">(</span><span class="string">'users.views.show_login'</span><span class="operator">)</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">                <span class="keyword">elif</span> <span class="name">ret</span> <span class="operator">==</span> <span class="number">1</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                        <span class="name">errorMsg</span> <span class="operator">=</span> <span class="string">"That username is already taken"</span></span><span class="text">
</span><span class="notcovered">                <span class="keyword">elif</span> <span class="name">ret</span> <span class="operator">==</span> <span class="number">2</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                        <span class="name">errorMsg</span> <span class="operator">=</span> <span class="string">"Passwords do not match"</span></span><span class="text">
</span><span class="notcovered">                <span class="keyword">elif</span> <span class="name">ret</span> <span class="operator">==</span> <span class="number">3</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                        <span class="name">errorMsg</span> <span class="operator">=</span> <span class="string">"The username field is empty"</span></span><span class="text">
</span><span class="notcovered">                <span class="keyword">elif</span> <span class="name">ret</span> <span class="operator">==</span> <span class="number">4</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                        <span class="name">errorMsg</span> <span class="operator">=</span> <span class="string">"The password field is empty"</span></span><span class="text">
</span><span class="notcovered">                <span class="keyword">else</span><span class="operator">:</span> <span class="comment">#ret == 5</span></span><span class="text">
</span><span class="notcovered">                        <span class="name">errorMsg</span> <span class="operator">=</span> <span class="string">"Either first name or last name field is empty"</span></span><span class="text">
</span><span class="notcovered">                <span class="keyword">return</span> <span class="name">render_to_response</span><span class="operator">(</span><span class="string">'user/register-new-user.html'</span><span class="operator">,</span> <span class="operator">{</span><span class="string">'message'</span><span class="operator">:</span> <span class="name">errorMsg</span><span class="operator">}</span><span class="operator">)</span></span><span class="text">
</span><span class="notcovered">        <span class="keyword">else</span><span class="operator">:</span></span><span class="text">
</span><span class="notcovered">                <span class="keyword">return</span> <span class="name">render_to_response</span><span class="operator">(</span><span class="string">'user/register-new-user.html'</span><span class="operator">)</span><span class="text"></span></span>
</pre></body>
</html>
